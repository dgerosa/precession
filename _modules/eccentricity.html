

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eccentricity &mdash; precession 2.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=20623aea"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            precession
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Readme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../circular.html">precession: package documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eccentric.html">precession.eccentricity: package documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">precession</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">eccentricity</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for eccentricity</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">precession</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.optimize</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.integrate</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module dynamically wraps functions from `precession.py`, replacing the `r` parameter</span>
<span class="sd">with `a` (semi-major axis) and `e` (eccentricity). </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">eccentricize</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="c1"># Replace &#39;r&#39; with &#39;a&#39; and &#39;e&#39; in the function signature</span>
    <span class="n">new_params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span>
            <span class="n">new_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">))</span>
            <span class="n">new_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">new_sig</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">new_params</span><span class="p">)</span>

    <span class="c1"># Update the docstring</span>
    <span class="n">old_doc</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="k">if</span> <span class="n">old_doc</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">old_doc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">skip_next</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            
            <span class="c1"># Replace &#39;r:&#39; parameter block with a/e</span>
            <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;r: float, optional (default: None)&#39;</span><span class="p">):</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;r:&#39;</span><span class="p">)]</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">a: float, optional (default: None)&quot;</span><span class="p">)</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">    Semi-major axis.&quot;</span><span class="p">)</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">e: float, optional (default: None)&quot;</span><span class="p">)</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">    Eccentricity: 0&lt;=e&lt;1&quot;</span><span class="p">)</span>
                <span class="n">skip_next</span> <span class="o">=</span> <span class="kc">True</span> 
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;r: &#39;</span><span class="p">):</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;r:&#39;</span><span class="p">)]</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">a: float&quot;</span><span class="p">)</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">    Semi-major axis.&quot;</span><span class="p">)</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">e: float&quot;</span><span class="p">)</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">    Eccentricity: 0&lt;=e&lt;1&quot;</span><span class="p">)</span>
                <span class="n">skip_next</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">skip_next</span><span class="p">:</span>
                <span class="n">skip_next</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>

            <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;r=r,&#39;</span><span class="p">,</span> <span class="s1">&#39;a=a,e=e,&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;,r,&#39;</span><span class="p">,</span> <span class="s1">&#39;,a,e,&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="n">new_doc</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
     <span class="n">new_doc</span> <span class="o">=</span> <span class="kc">None</span>



    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">bound_new</span> <span class="o">=</span> <span class="n">new_sig</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">bound_new</span><span class="o">.</span><span class="n">apply_defaults</span><span class="p">()</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">bound_new</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">bound_new</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bound_new</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>

        <span class="n">bound_orig</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
        <span class="n">bound_orig</span><span class="o">.</span><span class="n">apply_defaults</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">bound_orig</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">bound_orig</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">wrapper</span><span class="o">.</span><span class="n">__signature__</span> <span class="o">=</span> <span class="n">new_sig</span>
    <span class="n">wrapper</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">new_doc</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="c1"># Load the original functions from precession.py</span>
<span class="n">functions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;roots_vec&#39;</span><span class="p">,</span>
 <span class="s1">&#39;norm_nested&#39;</span><span class="p">,</span>
 <span class="s1">&#39;normalize_nested&#39;</span><span class="p">,</span>
 <span class="s1">&#39;dot_nested&#39;</span><span class="p">,</span>
 <span class="s1">&#39;scalar_nested&#39;</span><span class="p">,</span>
 <span class="s1">&#39;rotate_nested&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sample_unitsphere&#39;</span><span class="p">,</span>
 <span class="s1">&#39;isotropic_angles&#39;</span><span class="p">,</span>
 <span class="s1">&#39;tiler&#39;</span><span class="p">,</span>
 <span class="s1">&#39;affine&#39;</span><span class="p">,</span>
 <span class="s1">&#39;inverseaffine&#39;</span><span class="p">,</span>
 <span class="s1">&#39;wraproots&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ellippi&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ismonotonic&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_m1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_m2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_q&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_eta&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_S1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_S2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_chi1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_chi2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_L&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_v&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_u&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_chieff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_deltachi&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_deltachiinf&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_costheta1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_theta1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_costheta2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_theta2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_costheta12&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_theta12&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_cosdeltaphi&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_deltaphi&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_costhetaL&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_thetaL&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_J&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_kappa&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_S&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_cyclesign&#39;</span><span class="p">,</span>
 <span class="s1">&#39;conserved_to_angles&#39;</span><span class="p">,</span>
 <span class="s1">&#39;angles_to_conserved&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vectors_to_angles&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vectors_to_Jframe&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vectors_to_Lframe&#39;</span><span class="p">,</span>
 <span class="s1">&#39;angles_to_Lframe&#39;</span><span class="p">,</span>
 <span class="s1">&#39;angles_to_Jframe&#39;</span><span class="p">,</span>
 <span class="s1">&#39;conserved_to_Lframe&#39;</span><span class="p">,</span>
 <span class="s1">&#39;conserved_to_Jframe&#39;</span><span class="p">,</span>
 <span class="s1">&#39;kappadiscriminant_coefficients&#39;</span><span class="p">,</span>
 <span class="s1">&#39;kappalimits_geometrical&#39;</span><span class="p">,</span>
 <span class="s1">&#39;kapparesonances&#39;</span><span class="p">,</span>
 <span class="s1">&#39;kapparescaling&#39;</span><span class="p">,</span>
 <span class="s1">&#39;kappalimits&#39;</span><span class="p">,</span>
 <span class="s1">&#39;chiefflimits&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachilimits_definition&#39;</span><span class="p">,</span>
 <span class="s1">&#39;anglesresonances&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachicubic_coefficients&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachicubic_rescaled_coefficients&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachiroots&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachilimits_rectangle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachilimits_plusminus&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachilimits&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachirescaling&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachiresonance&#39;</span><span class="p">,</span>
 <span class="s1">&#39;elliptic_parameter&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachitildeav&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachitildeav2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;dchidt2_RHS&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_tau&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachioft&#39;</span><span class="p">,</span>
 <span class="s1">&#39;tofdeltachi&#39;</span><span class="p">,</span>
 <span class="s1">&#39;deltachisampling&#39;</span><span class="p">,</span>
 <span class="s1">&#39;intertial_ingredients&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_OmegaL&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_phiL&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_alpha&#39;</span><span class="p">,</span>
 <span class="s1">&#39;morphology&#39;</span><span class="p">,</span>
 <span class="s1">&#39;chip_terms&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_chip_heuristic&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_chip_generalized&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_chip_averaged&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_chip_rms&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_chip&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_nutation_freq&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_bracket_omega&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_delta_omega&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_delta_theta&#39;</span><span class="p">,</span>
 <span class="s1">&#39;eval_bracket_theta&#39;</span><span class="p">,</span>
 <span class="s1">&#39;rupdown&#39;</span><span class="p">,</span>
 <span class="s1">&#39;updown_endpoint&#39;</span><span class="p">,</span>
 <span class="s1">&#39;angleresonances_endpoint&#39;</span><span class="p">,</span>
 <span class="s1">&#39;omegasq_aligned&#39;</span><span class="p">,</span>
 <span class="s1">&#39;widenutation_separation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;widenutation_condition&#39;</span><span class="p">,</span>
 <span class="s1">&#39;rhs_precav&#39;</span><span class="p">,</span>
 <span class="s1">&#39;integrator_precav&#39;</span><span class="p">,</span>
 <span class="s1">&#39;precession_average&#39;</span><span class="p">,</span>
 <span class="s1">&#39;inspiral&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1"># Apply eccentricize and expose the new functions</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
    <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">precession</span> <span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;r&#39;</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">eccentricize</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># No &#39;r&#39; param, keep original function as is</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>

<div class="viewcode-block" id="eval_a">
<a class="viewcode-back" href="../eccentric.html#eccentricity.eval_a">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">eval_a</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">uc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Semi-major axis of the binary. Valid inputs are either  (L,e,q) or (u,e,q) or (uc,q).</span>

<span class="sd">    Call</span>
<span class="sd">    ----</span>
<span class="sd">    a = eval_a(a=a, L=L,u=u,e=e,q=q)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    L: float, optional (default: None)</span>
<span class="sd">        Magnitude of the Newtonian orbital angular momentum.</span>
<span class="sd">    u: float, optional (default: None)</span>
<span class="sd">        Compactified separation 1/(2L).</span>
<span class="sd">    uc: float, optional (default: None)</span>
<span class="sd">        Circular compactified separation uc=u(e=0).    </span>
<span class="sd">    e: float (default: 0)</span>
<span class="sd">        Binary eccentricity: 0&lt;=e&lt;1.     </span>
<span class="sd">    q: float, optional (default: None)</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a: float</span>
<span class="sd">        Binary semi-major axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
   
    <span class="k">if</span> <span class="n">L</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">q</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">L</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">q</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">L</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
         <span class="n">eta</span><span class="o">=</span><span class="n">eval_eta</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
         <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">uc</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Provide either  (L,e,q) or (u,e,q) or (uc, q)&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span></div>


<div class="viewcode-block" id="eval_e">
<a class="viewcode-back" href="../eccentric.html#eccentricity.eval_e">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">eval_e</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">uc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orbital eccentricity of the binary. Valid inputs are either (L,a,q) or (u,uc,q).</span>

<span class="sd">    Call</span>
<span class="sd">    ----</span>
<span class="sd">    e = eval_e(L=L, a=a, q=q)</span>
<span class="sd">    e = eval_e(u=u, uc=uc, q=q)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    L: float, optional (default: None)</span>
<span class="sd">        Magnitude of the Newtonian orbital angular momentum.</span>
<span class="sd">    u: float, optional (default: None)</span>
<span class="sd">        Compactified separation 1/(2L).</span>
<span class="sd">    uc: float, optional (default: None)</span>
<span class="sd">        Circular compactified separation uc=u(e=0).   </span>
<span class="sd">    a: float, optional (default: None)</span>
<span class="sd">        Binary semi-major axis.</span>
<span class="sd">    q: float, optional (default: None)</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    e: float</span>
<span class="sd">        Binary eccentricity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
   
    <span class="k">if</span> <span class="n">L</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
        <span class="n">pre_E</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span> <span class="p">((</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">q</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span> 
        <span class="n">pre_E</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pre_E</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pre_E</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pre_E</span><span class="p">)</span> 
   

    <span class="k">elif</span> <span class="n">L</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">uc</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">uc</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">uc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">L</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">a</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">q</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">q</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="n">q</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="n">q</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">u</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Provide either (L,a,q) or (u, uc,q).&quot;</span><span class="p">)</span>    
    
    <span class="k">return</span> <span class="n">e</span></div>


<div class="viewcode-block" id="ddchidt_prefactor">
<a class="viewcode-back" href="../eccentric.html#eccentricity.ddchidt_prefactor">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ddchidt_prefactor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    etamerical prefactor to the ddeltachi/dt derivative.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a: float</span>
<span class="sd">        Semi-major axis.</span>
<span class="sd">    e: float</span>
<span class="sd">        Eccentricity: 0&lt;=e&lt;1.    </span>
<span class="sd">    chieff: float</span>
<span class="sd">        Effective spin.</span>
<span class="sd">    q: float</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mathcalA: float</span>
<span class="sd">        Prefactor in the ddeltachi/dt equation.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``mathcalA = precession.ddchidt_prefactor(a,e,chieff,q)``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chieff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chieff</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mathcalA</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">chieff</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mf">0.5</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mathcalA</span>        </div>


<div class="viewcode-block" id="vectors_to_conserved">
<a class="viewcode-back" href="../eccentric.html#eccentricity.vectors_to_conserved">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">vectors_to_conserved</span><span class="p">(</span><span class="n">Lvec</span><span class="p">,</span> <span class="n">S1vec</span><span class="p">,</span> <span class="n">S2vec</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span> <span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert vectors (L,S1,S2) to conserved quanties (deltachi,kappa,chieff).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Lvec: array</span>
<span class="sd">        Cartesian vector of the orbital angular momentum.</span>
<span class="sd">    S1vec: array</span>
<span class="sd">        Cartesian vector of the primary spin.</span>
<span class="sd">    S2vec: array</span>
<span class="sd">        Cartesian vector of the secondary spin.</span>
<span class="sd">    q: float</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    full_output: boolean, optional (default: False)</span>
<span class="sd">        Return additional outputs.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    chieff: float</span>
<span class="sd">        Effective spin.</span>
<span class="sd">    cyclesign: integer, optional</span>
<span class="sd">        Sign (either +1 or -1) to cover the two halves of a precesion cycle.</span>
<span class="sd">    deltachi: float</span>
<span class="sd">        Weighted spin difference.</span>
<span class="sd">    kappa: float</span>
<span class="sd">        Asymptotic angular momentum.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``deltachi,kappa,chieff = precession.vectors_to_conserved(Lvec,S1vec,S2vec,q)``</span>
<span class="sd">    ``deltachi,kappa,chieff,cyclesign = precession.vectors_to_conserved(Lvec,S1vec,S2vec,q,full_output=True)``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">L</span> <span class="o">=</span> <span class="n">norm_nested</span><span class="p">(</span><span class="n">Lvec</span><span class="p">)</span>
    <span class="n">S1</span> <span class="o">=</span> <span class="n">norm_nested</span><span class="p">(</span><span class="n">S1vec</span><span class="p">)</span>
    <span class="n">S2</span> <span class="o">=</span> <span class="n">norm_nested</span><span class="p">(</span><span class="n">S2vec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span>  <span class="kc">None</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">eval_a</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span><span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">e</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">eval_e</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>    
 
    <span class="n">chi1</span> <span class="o">=</span> <span class="n">eval_chi1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">S1</span><span class="p">)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">eval_chi2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">S2</span><span class="p">)</span>

    <span class="n">theta1</span><span class="p">,</span><span class="n">theta2</span><span class="p">,</span><span class="n">deltaphi</span> <span class="o">=</span> <span class="n">vectors_to_angles</span><span class="p">(</span><span class="n">Lvec</span><span class="p">,</span> <span class="n">S1vec</span><span class="p">,</span> <span class="n">S2vec</span><span class="p">)</span>

    <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">cyclesign</span><span class="o">=</span> <span class="n">angles_to_conserved</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">full_output</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">cyclesign</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">chieff</span><span class="p">])</span></div>


<div class="viewcode-block" id="implicit">
<a class="viewcode-back" href="../eccentric.html#eccentricity.implicit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">implicit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">uc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LHS of eq. (28) in Fumagalli &amp; Gerosa, arXiv:2310.16893. This is used to compute the implicit function u(uc) in the inspiral_precav function.</span>
<span class="sd">    Parameters </span>
<span class="sd">    ----------</span>
<span class="sd">    u: float</span>
<span class="sd">        Compactified separation 1/(2L).</span>
<span class="sd">    uc: float</span>
<span class="sd">        Circular compactified separation 1/(2L(e=0)).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uc</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="p">(</span><span class="mi">37</span><span class="o">/</span><span class="mi">84</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">uc</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">121</span><span class="o">/</span><span class="mi">532</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">uc</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span><span class="p">(</span><span class="mi">121</span><span class="o">/</span><span class="mi">425</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">145</span><span class="o">/</span><span class="mi">532</span><span class="p">)</span></div>


<div class="viewcode-block" id="inspiral_precav">
<a class="viewcode-back" href="../eccentric.html#eccentricity.inspiral_precav">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">inspiral_precav</span><span class="p">(</span><span class="n">theta1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theta2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deltaphi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">deltachi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chieff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chi1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chi2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">requested_outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">enforce</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">odeint_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The integration range must be specified using either (a,e) or (uc, u), (and not both). These need to be arrays with lenght &gt;=1, where e.g. a[0] corresponds to the initial condition and a[1:] corresponds to the location where outputs are returned. Do not go to past time infinity with e!=0.</span>
<span class="sd">    The function is vectorized: evolving N multiple binaries with M outputs requires kappainitial, chieff, q, chi1, chi2 to be of shape (N,) and u of shape (M,N).</span>
<span class="sd">    The initial conditions must be specified in terms of one an only one of the following:</span>
<span class="sd">        - theta1,theta2, and deltaphi.</span>
<span class="sd">        - kappa, chieff.</span>
<span class="sd">    The desired outputs can be specified with a list e.g. requested_outputs=[&#39;theta1&#39;,&#39;theta2&#39;,&#39;deltaphi&#39;]. All the available variables are returned by default. These are: [&#39;theta1&#39;, &#39;theta2&#39;, &#39;deltaphi&#39;, &#39;deltachi&#39;, &#39;kappa&#39;, &#39;a&#39;, &#39;e&#39;, &#39;u&#39;, &#39;deltachiminus&#39;, &#39;deltachiplus&#39;, &#39;deltachi3&#39;, &#39;chieff&#39;, &#39;q&#39;, &#39;chi1&#39;, &#39;chi2&#39;].</span>
<span class="sd">    The flag enforce allows checking the consistency of the input variables.</span>
<span class="sd">    Additional keywords arguments are passed to `scipy.integrate.odeint` after some custom-made default settings.</span>

<span class="sd">     Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta1: float, optional (default: None)</span>
<span class="sd">        Angle between orbital angular momentum and primary spin.</span>
<span class="sd">    theta2: float, optional (default: None)</span>
<span class="sd">        Angle between orbital angular momentum and secondary spin.</span>
<span class="sd">    deltaphi: float, optional (default: None)</span>
<span class="sd">        Angle between the projections of the two spins onto the orbital plane.</span>
<span class="sd">    kappa: float, optional (default: None)</span>
<span class="sd">        Asymptotic angular momentum.</span>
<span class="sd">    r: float, optional (default: None)</span>
<span class="sd">        Binary separation.</span>
<span class="sd">    u: float, optional (default: None)</span>
<span class="sd">        Compactified separation 1/(2L).</span>
<span class="sd">    chieff: float, optional (default: None)</span>
<span class="sd">        Effective spin.</span>
<span class="sd">    q: float, optional (default: None)</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    chi1: float, optional (default: None)</span>
<span class="sd">        Dimensionless spin of the primary (heavier) black hole: 0&lt;=chi1&lt;=1.</span>
<span class="sd">    chi2: float, optional (default: None)</span>
<span class="sd">        Dimensionless spin of the secondary (lighter) black hole: 0&lt;=chi2&lt;=1.</span>
<span class="sd">    requested_outputs: list, optional (default: None)</span>
<span class="sd">        Set of outputs.</span>
<span class="sd">    enforce: boolean, optional (default: False)</span>
<span class="sd">        If True raise errors, if False raise warnings.</span>
<span class="sd">    **odeint_kwargs: unpacked dictionary, optional</span>
<span class="sd">        Additional keyword arguments.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    outputs: dictionary</span>
<span class="sd">        Set of outputs.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``outputs = precession.inspiral_precav(theta1=theta1,theta2=theta2,deltaphi=deltaphi,a=a,e=e,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_precav(theta1=theta1,theta2=theta2,deltaphi=deltaphi,uc=uc,u=u,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_precav(kappa,a=a,e=e,chieff=chieff,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_precav(kappa,uc=uc,u=u,chieff=chieff,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Substitute None inputs with arrays of Nones</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tiler</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span>   <span class="n">k</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">6</span> <span class="p">:</span>  <span class="c1"># Either  (a,e) or (uc, uc)</span>
                    <span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Any of the others</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                
    <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span>  <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span> <span class="o">=</span> <span class="n">inputs</span>
    <span class="c1"># This array has to match the outputs of _compute (in the right order!)</span>
    <span class="n">alloutputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;theta1&#39;</span><span class="p">,</span> <span class="s1">&#39;theta2&#39;</span><span class="p">,</span> <span class="s1">&#39;deltaphi&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachi&#39;</span><span class="p">,</span> <span class="s1">&#39;kappa&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;uc&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachiminus&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachiplus&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachi3&#39;</span><span class="p">,</span> <span class="s1">&#39;chieff&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">])</span>
    <span class="c1"># If in doubt, return everything</span>
    <span class="k">if</span> <span class="n">requested_outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">requested_outputs</span> <span class="o">=</span> <span class="n">alloutputs</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_compute</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">):</span>
        
        <span class="c1"># Make sure you have q, chi1, and chi2.</span>
        <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">chi1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">chi2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please provide q, chi1, and chi2.&quot;</span><span class="p">)</span>
        <span class="c1">## User pass (a, e0) -&gt; return uc and u [from u recover e]</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">ismonotonic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">ismonotonic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">)),</span> <span class="s1">&#39;a must be monotonic&#39;</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
                     <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span> <span class="p">:</span> <span class="n">implicit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">uc</span><span class="p">)</span> <span class="o">-</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">uc</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">)</span>
                <span class="n">uc_vals</span> <span class="o">=</span><span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">tiler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
                <span class="n">u0</span> <span class="o">=</span> <span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
                <span class="n">c0</span> <span class="o">=</span> <span class="n">implicit</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">uc_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
                <span class="n">us</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">eb</span><span class="o">=</span><span class="n">e</span>
                <span class="k">for</span> <span class="n">uc</span> <span class="ow">in</span> <span class="n">uc_vals</span><span class="p">:</span> 
                   <span class="n">u</span><span class="o">=</span><span class="n">solve</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span><span class="n">c0</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>
                   <span class="n">eb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">uc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                   <span class="n">us</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
                <span class="n">u</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
                <span class="n">uc</span> <span class="o">=</span> <span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">tiler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tiler</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
                <span class="n">uc</span><span class="o">=</span><span class="n">u</span>
         <span class="c1">## User pass (uc, u0) -&gt; return a, e0, u [from u recover e]   </span>
        <span class="k">elif</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>  <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">uc</span><span class="p">)</span> <span class="o">&gt;</span>  <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
           <span class="c1"># print(&#39;dentro&#39;)</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">ismonotonic</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">ismonotonic</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">)),</span> <span class="s1">&#39;uc must be monotonic&#39;</span>
            <span class="k">if</span> <span class="n">uc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">u</span><span class="p">:</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
                     <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span> <span class="p">:</span> <span class="n">implicit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">uc</span><span class="p">)</span> <span class="o">-</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">uc</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">)</span>
                <span class="n">c0</span> <span class="o">=</span> <span class="n">implicit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">uc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
                <span class="n">us</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">eb</span><span class="o">=</span><span class="n">eval_e</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">uc</span><span class="o">=</span><span class="n">uc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ucs</span> <span class="ow">in</span> <span class="n">uc</span><span class="p">:</span> 
                   <span class="n">u</span><span class="o">=</span><span class="n">solve</span><span class="p">(</span><span class="n">ucs</span><span class="p">,</span><span class="n">c0</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>
                   <span class="n">eb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ucs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                   <span class="n">us</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
                <span class="n">u</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
                <span class="n">a</span><span class="o">=</span><span class="n">eval_a</span><span class="p">(</span><span class="n">uc</span><span class="o">=</span><span class="n">uc</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">uc</span><span class="p">))</span>
                <span class="n">e</span><span class="o">=</span><span class="n">eval_e</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uc</span><span class="o">=</span><span class="n">uc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">u</span><span class="o">=</span><span class="n">uc</span>
               <span class="n">a</span><span class="o">=</span><span class="n">eval_a</span><span class="p">(</span><span class="n">uc</span><span class="o">=</span><span class="n">uc</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">uc</span><span class="p">))</span> 
               <span class="n">e</span><span class="o">=</span><span class="mi">0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please provide either (a,e0) or (uc, u0).  Do not work at infinity.&quot;</span><span class="p">)</span>
     
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;There can only be one a=np.inf location, either at the beginning or at the end.&quot;</span>
       
        <span class="k">if</span> <span class="n">theta1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">theta2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deltaphi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kappa</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chieff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                 <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">chieff</span> <span class="o">=</span> <span class="n">angles_to_conserved</span><span class="p">(</span><span class="n">theta1</span><span class="o">=</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="o">=</span><span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="o">=</span><span class="n">deltaphi</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span><span class="n">chi1</span><span class="o">=</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="o">=</span><span class="n">chi2</span><span class="p">)</span>
        <span class="c1"># User provides kappa, chieff, and maybe deltachi.</span>
        <span class="k">elif</span> <span class="n">theta1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">theta2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deltaphi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kappa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chieff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please provide one and not more of the following: (theta1,theta2,deltaphi), (kappa,chieff).&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">enforce</span><span class="p">:</span> <span class="c1"># Enforce limits</span>
            <span class="n">chieffmin</span><span class="p">,</span> <span class="n">chieffmax</span> <span class="o">=</span> <span class="n">chiefflimits</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">chieff</span> <span class="o">&gt;=</span> <span class="n">chieffmin</span> <span class="ow">and</span> <span class="n">chieff</span> <span class="o">&lt;=</span> <span class="n">chieffmax</span><span class="p">,</span>  <span class="s2">&quot;Unphysical initial conditions [inspiral_precav].&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span> <span class="n">chieffmin</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">chieffmax</span> <span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">chieff</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">chi2</span><span class="p">)</span>
            <span class="n">kappamin</span><span class="p">,</span><span class="n">kappamax</span> <span class="o">=</span> <span class="n">kappalimits</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">,</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">chieff</span><span class="o">=</span><span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="o">=</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="o">=</span><span class="n">chi2</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">kappa</span> <span class="o">&gt;=</span> <span class="n">kappamin</span> <span class="ow">and</span> <span class="n">kappa</span> <span class="o">&lt;=</span> <span class="n">kappamax</span><span class="p">,</span> <span class="s2">&quot;kappa Unphysical initial conditions [inspiral_precav].&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kappamin</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kappamax</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">chieff</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">chi2</span><span class="p">)</span>

        <span class="c1"># Actual integration.</span>
        
        <span class="n">kappa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">integrator_precav</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span><span class="o">**</span><span class="n">odeint_kwargs</span><span class="p">))</span>
        <span class="n">deltachiminus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">deltachiplus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">deltachi3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">deltachi</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">theta1</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">theta2</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">deltaphi</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># If e=0, the evolution is trivial</span>
            <span class="n">e</span><span class="o">=</span><span class="n">eval_e</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>  

        <span class="c1"># Roots along the evolution</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">requested_outputs</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;theta1&#39;</span><span class="p">,</span> <span class="s1">&#39;theta2&#39;</span><span class="p">,</span> <span class="s1">&#39;deltaphi&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachi&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachiminus&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachiplus&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachi3&#39;</span><span class="p">]):</span>
            <span class="n">deltachiminus</span><span class="p">,</span><span class="n">deltachiplus</span><span class="p">,</span><span class="n">deltachi3</span> <span class="o">=</span> <span class="n">deltachiroots</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">tiler</span><span class="p">(</span><span class="n">chieff</span><span class="p">,</span><span class="n">u</span><span class="p">),</span> <span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">u</span><span class="p">),</span><span class="n">tiler</span><span class="p">(</span><span class="n">chi1</span><span class="p">,</span><span class="n">u</span><span class="p">),</span><span class="n">tiler</span><span class="p">(</span><span class="n">chi2</span><span class="p">,</span><span class="n">u</span><span class="p">))</span>
                    
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">requested_outputs</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;theta1&#39;</span><span class="p">,</span> <span class="s1">&#39;theta2&#39;</span><span class="p">,</span> <span class="s1">&#39;deltaphi&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachi&#39;</span><span class="p">]):</span>
                <span class="c1">#print(kappa, a,e,u)</span>
                <span class="n">deltachi</span> <span class="o">=</span> <span class="n">deltachisampling</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">tiler</span><span class="p">(</span><span class="n">chieff</span><span class="p">,</span><span class="n">u</span><span class="p">),</span> <span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">u</span><span class="p">),</span><span class="n">tiler</span><span class="p">(</span><span class="n">chi1</span><span class="p">,</span><span class="n">u</span><span class="p">),</span><span class="n">tiler</span><span class="p">(</span><span class="n">chi2</span><span class="p">,</span><span class="n">u</span><span class="p">),</span> <span class="n">precomputedroots</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">deltachiminus</span><span class="p">,</span><span class="n">deltachiplus</span><span class="p">,</span><span class="n">deltachi3</span><span class="p">]))</span>
                <span class="c1"># Compute the angles. Assign random cyclesign</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">requested_outputs</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;theta1&#39;</span><span class="p">,</span> <span class="s1">&#39;theta2&#39;</span><span class="p">,</span> <span class="s1">&#39;deltaphi&#39;</span><span class="p">]):</span>
                    <span class="n">theta1</span><span class="p">,</span><span class="n">theta2</span><span class="p">,</span><span class="n">deltaphi</span> <span class="o">=</span> <span class="n">conserved_to_angles</span><span class="p">(</span><span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">tiler</span><span class="p">(</span><span class="n">chieff</span><span class="p">,</span><span class="n">u</span><span class="p">),</span> <span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">u</span><span class="p">),</span><span class="n">tiler</span><span class="p">(</span><span class="n">chi1</span><span class="p">,</span><span class="n">u</span><span class="p">),</span><span class="n">tiler</span><span class="p">(</span><span class="n">chi2</span><span class="p">,</span><span class="n">u</span><span class="p">),</span> <span class="n">cyclesign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span><span class="n">u</span><span class="p">,</span> <span class="n">deltachiminus</span><span class="p">,</span> <span class="n">deltachiplus</span><span class="p">,</span> <span class="n">deltachi3</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span>
    <span class="c1"># Here I force dtype=object buse the outputs have different shapes</span>
    <span class="n">allresults</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_compute</span><span class="p">,</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
   
    <span class="c1"># Return only requested outputs (in1d return boolean array)</span>
    <span class="n">wantoutputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">alloutputs</span><span class="p">,</span> <span class="n">requested_outputs</span><span class="p">)</span>

    <span class="c1"># Store into a dictionary</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">alloutputs</span><span class="p">[</span><span class="n">wantoutputs</span><span class="p">],</span> <span class="n">allresults</span><span class="p">[</span><span class="n">wantoutputs</span><span class="p">]):</span>
        <span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

        <span class="c1"># For the constants of motion...</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;chieff&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;chi1&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;chi2&#39;</span><span class="p">:</span>  <span class="c1"># Constants of motion</span>
            <span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="c1">#... and everything else</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">outcome</span></div>


<div class="viewcode-block" id="rhs_orbav">
<a class="viewcode-back" href="../eccentric.html#eccentricity.rhs_orbav">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rhs_orbav</span><span class="p">(</span><span class="n">allvars</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">PNorderpre</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">PNorderrad</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">3</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Right-hand side of the systems of ODEs describing orbit-averaged inspiral. The equations are reported in Sec 4A of Gerosa and Kesden, arXiv:1605.01067. The format is d[allvars]/dv=RHS where allvars=[Lhx,Lhy,Lhz,S1hx,S1hy,S1hz,S2hx,S2hy,S2hz,t], h indicates unit vectors, v is the orbital velocity, and t is time.</span>
<span class="sd">    This is an internal function used by the ODE integrator and is not array-compatible.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    allvars: array</span>
<span class="sd">        Packed ODE input variables.</span>
<span class="sd">    a: float</span>
<span class="sd">        Newtonian orbital velocity.</span>
<span class="sd">    q: float</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    m1: float</span>
<span class="sd">        Mass of the primary (heavier) black hole.</span>
<span class="sd">    m2: float</span>
<span class="sd">        Mass of the secondary (lighter) black hole.</span>
<span class="sd">    eta: float</span>
<span class="sd">        Symmetric mass ratio 0&lt;=eta&lt;=1/4.</span>
<span class="sd">    chi1: float</span>
<span class="sd">        Dimensionless spin of the primary (heavier) black hole: 0&lt;=chi1&lt;=1.</span>
<span class="sd">    chi2: float</span>
<span class="sd">        Dimensionless spin of the secondary (lighter) black hole: 0&lt;=chi2&lt;=1.</span>
<span class="sd">    S1: float</span>
<span class="sd">        Magnitude of the primary spin.</span>
<span class="sd">    S2: float</span>
<span class="sd">        Magnitude of the secondary spin.</span>
<span class="sd">    PNorderpre: array (default: [0,0.5])</span>
<span class="sd">        PN orders considered in the spin-precession equations.</span>
<span class="sd">    PNorderrad: array (default: [0,0.5])</span>
<span class="sd">        PN orders considered in the radiation-reaction equation.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    RHS: float</span>
<span class="sd">        Right-hand side.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``RHS = precession.rhs_orbav(allvars,a,q,m1,m2,eta,chi1,chi2,S1,S2,PNorderpre=[0,0.5],PNorderrad=[0,1,1.5,2,2.5,3])``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Unpack inputs</span>
  
    <span class="n">Lh</span> <span class="o">=</span> <span class="n">allvars</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">S1h</span> <span class="o">=</span> <span class="n">allvars</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">S2h</span> <span class="o">=</span> <span class="n">allvars</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">delta_lambda</span> <span class="o">=</span> <span class="n">allvars</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">Ph</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">delta_lambda</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta_lambda</span><span class="p">),</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">allvars</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">allvars</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>

    
    <span class="n">u</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
    


    <span class="c1"># Angles </span>
    <span class="n">ct1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">S1h</span><span class="p">,</span> <span class="n">Lh</span><span class="p">)</span>
    <span class="n">ct2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">S2h</span><span class="p">,</span> <span class="n">Lh</span><span class="p">)</span>
    <span class="n">c12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">S1h</span><span class="p">,</span> <span class="n">S2h</span><span class="p">)</span>
    <span class="n">cphi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ph</span><span class="p">,</span> <span class="n">S1h</span><span class="p">)</span>
    <span class="n">cphi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ph</span><span class="p">,</span> <span class="n">S2h</span><span class="p">)</span>

    <span class="n">c2phi1</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">cphi1</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">c2phi2</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">cphi2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">c2phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cphi1</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cphi2</span><span class="p">)))</span>
  

   
    
   
    <span class="c1"># Spin precession for S1</span>
    <span class="n">Omega1</span><span class="o">=</span>  <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">PNorderpre</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span><span class="p">(</span><span class="mf">0.5</span> <span class="ow">in</span> <span class="n">PNorderpre</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="o">-</span><span class="mi">32</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> \
    <span class="n">ct1</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">ct2</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ct1</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">+</span> <span class="n">ct2</span> <span class="o">*</span> <span class="n">S2</span><span class="p">)</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">S2h</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> \
    <span class="n">ct1</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ct2</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))))))</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">6</span>
    <span class="n">dS1hdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">Omega1</span><span class="p">,</span> <span class="n">S1h</span><span class="p">)</span>

    <span class="c1"># Spin precession for S2</span>
    <span class="n">Omega2</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">PNorderpre</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span><span class="p">(</span><span class="mf">0.5</span> <span class="ow">in</span> <span class="n">PNorderpre</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">32</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> \
    <span class="n">ct1</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">ct2</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> \
    <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct1</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ct2</span> <span class="o">*</span> <span class="n">S2</span><span class="p">)</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">S1h</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> \
    <span class="n">ct1</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">ct2</span> <span class="o">*</span> <span class="n">Lh</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))))))</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">6</span>
    <span class="n">dS2hdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">Omega2</span><span class="p">,</span> <span class="n">S2h</span><span class="p">)</span>


    <span class="c1"># Conservation of angular momentum</span>
    <span class="n">OmegaL</span><span class="o">=</span>  <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">PNorderpre</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> \
    <span class="n">S1h</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">S2h</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span> <span class="o">*</span> <span class="n">S1h</span> <span class="o">+</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">S2h</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">6</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5</span> <span class="ow">in</span> <span class="n">PNorderpre</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">192</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">ct1</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">+</span> <span class="n">ct2</span> <span class="o">*</span> <span class="n">S2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">S1h</span> <span class="o">+</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">S2h</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">7</span>
    <span class="n">dLhdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">OmegaL</span><span class="p">,</span> <span class="n">Lh</span><span class="p">)</span>

    <span class="c1">#pn terms for dudt :&#39;) from Klein et al. 2018  arXiv:1801.08542</span>
    <span class="n">zero_pnterm_u</span><span class="o">=</span> <span class="mi">1024</span><span class="o">/</span><span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">one_pnterm_u</span> <span class="o">=</span> <span class="o">-</span><span class="mi">256</span><span class="o">/</span><span class="mi">315</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="p">(</span><span class="mi">743</span> <span class="o">+</span> \
    <span class="mi">924</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">9021</span> <span class="o">+</span> <span class="mi">6832</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">18444</span> <span class="o">+</span> <span class="mi">18403</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))</span>

    <span class="n">oneptfive_pnterm_u</span> <span class="o">=-</span><span class="mi">1</span><span class="o">/</span><span class="mi">1125</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="o">-</span><span class="mi">58982400</span> <span class="o">+</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">178790400</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">22579200</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">156800</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">43600</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2567</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">))))))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">153600</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">ct1</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">904</span> <span class="o">+</span> <span class="p">(</span><span class="mi">600</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">297</span> <span class="o">+</span> <span class="mi">314</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">556</span> <span class="o">+</span> <span class="mi">479</span> <span class="o">*</span> <span class="n">q</span><span class="p">))))</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">+</span> <span class="n">ct2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">600</span> <span class="o">+</span> <span class="p">(</span><span class="mi">904</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> \
    <span class="o">*</span> <span class="p">(</span><span class="mi">314</span> <span class="o">+</span> <span class="mi">297</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">479</span> <span class="o">+</span> <span class="mi">556</span> <span class="o">*</span> <span class="n">q</span><span class="p">))))</span> <span class="o">*</span> <span class="n">S2</span><span class="p">))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    
    <span class="n">two_pnterm_u</span><span class="o">=</span><span class="mi">64</span><span class="o">/</span><span class="mi">2679075</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2095517</span> <span class="o">+</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">8842605</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="mi">5826072</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="mi">34103</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">13661</span> <span class="o">+</span> <span class="mi">6608</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">513446</span> <span class="o">+</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1041522</span> <span class="o">+</span> \
    <span class="mi">1032101</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">378</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">624</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span> \
    <span class="o">*</span> <span class="p">(</span><span class="mi">280</span> <span class="o">+</span> <span class="p">(</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="mi">41</span> <span class="o">+</span> <span class="p">(</span><span class="mi">31</span> <span class="o">*</span> \
    <span class="n">c2phi</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1912</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="mi">860</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">251</span> <span class="o">+</span> <span class="p">(</span><span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> \
    <span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">))))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">756</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">160</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">144</span> <span class="o">+</span> <span class="p">(</span><span class="mi">149</span> <span class="o">*</span> \
    <span class="n">c2phi1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">21</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">160</span> <span class="o">+</span> \
    <span class="p">((</span><span class="mi">432</span> <span class="o">+</span> <span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">63</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">378</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">16</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> \
    <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi2</span> <span class="o">+</span> <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="n">c2phi2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))))</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="o">-</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">756</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="n">c12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">56</span> <span class="o">+</span> <span class="p">((</span><span class="mi">152</span> <span class="o">+</span> <span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">22</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct1</span> <span class="o">*</span> <span class="n">ct2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">968</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="mi">436</span> <span class="o">+</span> <span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">127</span> <span class="o">+</span> <span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">18</span> <span class="o">+</span> <span class="mi">59</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">128</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">298</span> <span class="o">*</span> \
    <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">424</span> <span class="o">+</span> <span class="p">(</span><span class="mi">298</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="o">-</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi2</span><span class="p">))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">19</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi2</span> <span class="o">+</span> \
    <span class="mi">31</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">c2phi2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span> <span class="o">*</span> \
    <span class="n">S2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">756</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="o">-</span><span class="mi">144</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">128</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">298</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi1</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">19</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">62</span> <span class="o">*</span> \
    <span class="n">c2phi</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">472</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">424</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">298</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="o">-</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">93</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> \
    <span class="o">*</span> <span class="n">c2phi1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="n">c12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">56</span> <span class="o">+</span> <span class="p">((</span><span class="mi">152</span> <span class="o">+</span> \
    <span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">22</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span> <span class="o">+</span> <span class="n">ct1</span> <span class="o">*</span> <span class="n">ct2</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">968</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="mi">436</span> <span class="o">+</span> <span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">127</span> <span class="o">+</span> <span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">))))</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">160</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">144</span> <span class="o">+</span> <span class="p">(</span><span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi2</span> \
    <span class="o">+</span> <span class="p">(</span><span class="mi">21</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">160</span> <span class="o">+</span> <span class="p">((</span><span class="mi">432</span> <span class="o">+</span> \
    <span class="mi">149</span> <span class="o">*</span> <span class="n">c2phi2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">63</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3024</span> <span class="o">*</span> <span class="p">(((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">((</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">42</span> <span class="o">*</span> <span class="n">c12</span> <span class="o">+</span> <span class="o">-</span><span class="mi">121</span> <span class="o">*</span> <span class="n">ct1</span> <span class="o">*</span> <span class="n">ct2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="n">S1</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">+</span> <span class="p">((</span><span class="mi">78</span> <span class="o">+</span> <span class="o">-</span><span class="mi">239</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">16</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">378</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> \
    <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2782</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">14</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">236</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="mi">236</span> <span class="o">*</span> <span class="n">c2phi1</span> <span class="o">+</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">7</span> <span class="o">+</span> <span class="p">(</span><span class="mi">236</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="o">-</span><span class="mi">236</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">c12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="mi">59</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">745</span> <span class="o">+</span> <span class="mi">236</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">ct1</span> <span class="o">*</span> <span class="n">ct2</span><span class="p">)</span> \
    <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">478</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">236</span> <span class="o">*</span> <span class="n">c2phi2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1469</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">236</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2phi</span> <span class="o">+</span> <span class="n">c2phi2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5564</span> <span class="o">*</span> \
    <span class="n">eta</span><span class="p">))))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">252</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">25</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">300</span> <span class="o">+</span> <span class="p">(</span><span class="mi">283</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">120</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">16</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">447</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="mi">447</span> <span class="o">*</span> <span class="n">c2phi1</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="mi">447</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="o">-</span><span class="mi">447</span> <span class="o">*</span> \
    <span class="n">c2phi1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">c12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">96</span> <span class="o">+</span> <span class="mi">149</span> <span class="o">*</span> \
    <span class="n">c2phi</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">824</span> <span class="o">+</span> <span class="mi">447</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">ct1</span> <span class="o">*</span> <span class="n">ct2</span><span class="p">)</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">528</span> <span class="o">+</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">447</span> <span class="o">*</span> <span class="n">c2phi2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1624</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">447</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2phi</span> <span class="o">+</span> \
    <span class="n">c2phi2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10225</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))))</span> <span class="o">+</span> <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">491400</span> <span class="o">+</span> <span class="p">(</span><span class="mi">653043</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">7020</span> <span class="o">+</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">29091</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">18784</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))))</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2593977</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">551124</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">14</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">81</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi1</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">62</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2phi</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">c2phi1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">22</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">127</span> <span class="o">+</span> <span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">ct1</span> <span class="o">*</span> <span class="n">ct2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="n">S1</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">82</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">62</span> <span class="o">*</span> <span class="n">c2phi2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">251</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="mi">62</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2phi</span> <span class="o">+</span> <span class="n">c2phi2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">17295</span> <span class="o">+</span> <span class="mi">18784</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))))))))))))</span>
    
    <span class="n">twoptfive_pnterm_u</span><span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">141750</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">11059200</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4159</span> <span class="o">+</span> <span class="mi">15876</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1843200</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">623013</span> <span class="o">+</span> \
    <span class="mi">904016</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">50</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">30227745</span> <span class="o">+</span> <span class="mi">3401956</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">9600</span> \
    <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">8437609</span> <span class="o">+</span> <span class="mi">8101664</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">57600</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">25148607</span> <span class="o">+</span> <span class="mi">24142172</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">114231477</span> <span class="o">+</span> <span class="mi">30218416</span> <span class="o">*</span> \
    <span class="n">eta</span><span class="p">))))))</span>

    <span class="n">three_pnterm_u</span><span class="o">=</span>  <span class="mi">4096</span><span class="o">/</span><span class="mi">5457375</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">16447322263</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">2277918720</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>  <span class="o">+</span> <span class="p">(</span><span class="mi">745113600</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1925</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">56198689</span> \
    <span class="o">+</span> <span class="mi">2045736</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="p">(</span><span class="mi">84355425</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">302109500</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">231</span><span class="o">/</span><span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">638542912</span> <span class="o">+</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">57250248</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">50188182</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">167385119</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9791850</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">75</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="mi">78992</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">15357104</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">7602068</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">21362455</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1020722</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)))))</span> <span class="o">+</span> <span class="o">-</span><span class="mi">861</span> <span class="o">*</span> <span class="p">(</span><span class="mi">32</span> \
    <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">412</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">787</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">18</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="mi">16800</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">3792</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">141892</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">47443</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">218035</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">11246</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)))))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">231</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">91284763</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">11682688</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">75</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">19505077</span> <span class="o">+</span> <span class="p">(</span><span class="mi">374850</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">20398980</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))))</span> \
    <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">525</span><span class="o">/</span><span class="mi">64</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">730533171</span> <span class="o">+</span> \
    <span class="mi">176</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">4179523</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">83701</span> <span class="o">+</span> <span class="mi">472752</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">742833926997</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">195616270080</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>  <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">4365900</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">14656</span> <span class="o">+</span> \
    <span class="mi">7155</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">385</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2828420479</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">38552508</span> <span class="o">+</span> \
    <span class="mi">13753075</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">/</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> \
    <span class="o">*</span> <span class="p">(</span><span class="mi">260224134453</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1637254080</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>  <span class="o">+</span> <span class="p">(</span><span class="mi">727650</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> \
    <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">736</span> <span class="o">+</span> <span class="mi">369</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1925</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">107275139</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">25779755</span> <span class="o">+</span> <span class="mi">22346352</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1419826662006</span> <span class="o">+</span> <span class="p">(</span><span class="mi">186219855360</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>  <span class="o">+</span> \
    <span class="p">(</span><span class="mi">363825</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">167424</span> <span class="o">+</span> <span class="mi">53131</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">770</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">2963572847</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">661859115</span> <span class="o">+</span> <span class="mi">492399488</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))))</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">160166160</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4050</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">988200</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">16992900</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">153995525</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">840554750</span> \
    <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3569058808</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)))))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">243</span> <span class="o">*</span> \
    <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">39</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2735</span><span class="o">/</span><span class="mi">64</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">25959</span><span class="o">/</span><span class="mi">512</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">638032239</span><span class="o">/</span><span class="mi">409600</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">)))))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">48828125</span><span class="o">/</span><span class="mi">5184</span> <span class="o">*</span> <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">83</span><span class="o">/</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12637</span><span class="o">/</span><span class="mi">256</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">4747561509943</span><span class="o">/</span><span class="mi">33177600</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">7</span><span class="p">))))</span> <span class="o">+</span> <span class="o">-</span><span class="mi">4449060</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">256</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">1832</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1308</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">69</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eta</span><span class="p">)))))))))))))))))</span>

    <span class="c1">#pn terms for dedt :&#39;) from Klein et al. 2018  arXiv:1801.08542</span>
    <span class="n">zero_pnterm_e</span><span class="o">=-</span><span class="mi">512</span><span class="o">/</span><span class="mi">15</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">304</span> <span class="o">+</span> <span class="mi">121</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">one_pnterm_e</span> <span class="o">=</span> <span class="mi">256</span><span class="o">/</span><span class="mi">315</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">8451</span> <span class="o">+</span> <span class="mi">28588</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">59834</span> <span class="o">+</span> <span class="mi">54271</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">125361</span> <span class="o">+</span> <span class="mi">93184</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))</span>

    <span class="n">oneptfive_pnterm_e</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8100</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">((</span><span class="o">-</span><span class="mi">4357324800</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">6601236480</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">557959680</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">598080</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1161732</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5971</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">))))))</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">368640</span> <span class="o">*</span> <span class="p">(</span><span class="n">ct1</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2461</span> <span class="o">+</span> <span class="mi">1629</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">28256</span> <span class="o">+</span> <span class="p">(</span><span class="mi">24270</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">789</span> <span class="o">+</span> <span class="mi">835</span> <span class="o">*</span> <span class="n">q</span><span class="p">))))</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">+</span> <span class="n">ct2</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1629</span> <span class="o">+</span> <span class="mi">2461</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">24270</span> <span class="o">+</span> <span class="p">(</span><span class="mi">28256</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> \
    <span class="o">*</span> <span class="p">(</span><span class="mi">835</span> <span class="o">+</span> <span class="mi">789</span> <span class="o">*</span> <span class="n">q</span><span class="p">))))</span> <span class="o">*</span> <span class="n">S2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    
    <span class="n">two_pnterm_e</span><span class="o">=-</span><span class="mi">128</span><span class="o">/</span><span class="mi">945</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">252</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">80</span> <span class="o">+</span> <span class="p">(</span><span class="mi">44984</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">71790</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> \
    <span class="mi">6705</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">ct1</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">+</span> <span class="n">ct2</span> <span class="o">*</span> <span class="n">S2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> \
    <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">504</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">+</span> <span class="p">(</span><span class="mi">15</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">83</span> <span class="o">+</span> <span class="mi">74</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">70</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">191</span> <span class="o">+</span> <span class="mi">170</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1023</span> <span class="o">+</span> <span class="mi">938</span> <span class="o">*</span> <span class="n">q</span><span class="p">))))</span> <span class="o">*</span> <span class="p">((</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">252</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">80</span> <span class="o">+</span> <span class="p">(</span><span class="mi">15688</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">25270</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2355</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c12</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">+</span> <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">504</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2809</span> <span class="o">+</span> \
    <span class="mi">2814</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="mi">15</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2406</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2380</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">75</span> <span class="o">+</span> \
    <span class="mi">37</span> <span class="o">*</span> <span class="n">q</span><span class="p">)))))</span> <span class="o">*</span> <span class="p">((</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">63</span> <span class="o">*</span> <span class="n">c2phi</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">88432</span> <span class="o">+</span> <span class="p">(</span><span class="mi">161872</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16521</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">c12</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ct1</span> <span class="o">*</span> \
    <span class="n">ct2</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">S2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">126</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> \
    <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">44224</span> <span class="o">+</span> <span class="p">(</span><span class="mi">44208</span> <span class="o">*</span> \
    <span class="n">q</span> <span class="o">+</span> <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">5061</span> <span class="o">+</span> <span class="mi">5056</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">8265</span> <span class="o">+</span> <span class="mi">8256</span> <span class="o">*</span> \
    <span class="n">q</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2phi1</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">c2phi2</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">ct2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">2016</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2672</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6963</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">565</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">952397</span> <span class="o">+</span> <span class="mi">27</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">29685</span> <span class="o">+</span> <span class="mi">10528</span> <span class="o">*</span> \
    <span class="n">eta</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">1262181</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">362071</span> <span class="o">+</span> <span class="mi">229880</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> \
    <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">3113989</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">388419</span> <span class="o">+</span> \
    <span class="mi">451031</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">23283055</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">13057267</span> <span class="o">+</span> <span class="mi">7135016</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))))))))))))</span>
    
    <span class="n">twoptfive_pnterm_e</span><span class="o">=</span><span class="mi">8192</span><span class="o">/</span><span class="mi">315</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">167073</span> <span class="o">+</span> <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">3311197679</span><span class="o">/</span><span class="mi">58982400</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">62161997121736</span><span class="o">/</span><span class="mi">6747704524825</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">610144</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="o">/</span><span class="mi">368640</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">45904599</span> <span class="o">+</span> <span class="mi">6209264</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">25</span><span class="o">/</span><span class="mi">192</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">12204489</span> <span class="o">+</span> <span class="mi">11870488</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">29712813</span> <span class="o">+</span> \
    <span class="mi">44912932</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">9216</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">652241337</span> <span class="o">+</span> <span class="mi">604953772</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))))))</span>

    <span class="n">three_pnterm_e</span><span class="o">=</span> <span class="mi">64</span><span class="o">/</span><span class="mi">16372125</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">259075289088</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5544</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">545113176</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4290992976</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">5321445613</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">210331125</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">25</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">44215928</span> <span class="o">+</span> <span class="p">(</span><span class="mi">229773342</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">132391555</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4345365</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> <span class="o">+</span> <span class="o">-</span><span class="mi">861</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3248</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6891</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">61</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="o">-</span><span class="mi">16800</span> <span class="o">*</span> <span class="p">(</span><span class="mi">108664</span> <span class="o">+</span> <span class="p">(</span><span class="mi">681989</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">450212</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">15985</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">175</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">8162698563</span> <span class="o">+</span> <span class="mi">176</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">51877449</span> <span class="o">+</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1853055</span> <span class="o">+</span> <span class="mi">1547168</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">320</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> \
    <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">184965635913</span> <span class="o">+</span> <span class="p">(</span><span class="mi">21896493696</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>  <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">291060</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">24608</span> <span class="o">+</span> <span class="mi">9153</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">77</span> <span class="o">*</span> \
    <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">130159011</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">112020219</span> <span class="o">+</span> <span class="mi">8540140</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">9773510894001</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">122366946240</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>  <span class="o">+</span> <span class="p">(</span><span class="mi">3274425</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">12224</span> <span class="o">+</span> \
    <span class="mi">6519</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">7700</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2479111137</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">336888585</span> <span class="o">+</span> \
    <span class="mi">165088966</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">7002074502438</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1017565274880</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>  <span class="o">+</span> <span class="p">(</span><span class="mi">121275</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2744576</span> <span class="o">+</span> <span class="mi">886677</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">770</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> \
    <span class="p">(</span><span class="o">-</span><span class="mi">8799500893</span> <span class="o">+</span> <span class="mi">45</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">351962207</span> <span class="o">+</span> <span class="mi">249002992</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1536480225768</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">3168584939520</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>  <span class="o">+</span> <span class="p">(</span><span class="mi">363825</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2848768</span> <span class="o">+</span> \
    <span class="mi">235905</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1540</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">20795802327</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">728238339</span> <span class="o">+</span> \
    <span class="mi">608373563</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)))))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1138959360</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2700</span> <span class="o">*</span> <span class="p">(</span><span class="mi">17647200</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">481982400</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">6453060300</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">46781466075</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">262622893260</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1732248932266</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">))))))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">6561</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">49</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4369</span><span class="o">/</span><span class="mi">64</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">214449</span><span class="o">/</span><span class="mi">512</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> \
    <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">623830739</span><span class="o">/</span><span class="mi">81920</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">76513915569</span><span class="o">/</span><span class="mi">1638400</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">10</span><span class="p">))))))</span> \
    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">48828125</span><span class="o">/</span><span class="mi">1769472</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">27648</span> <span class="o">+</span> <span class="p">(</span><span class="mi">337536</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1908084</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6631171</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> \
    <span class="o">+</span> <span class="mi">4747561509943</span><span class="o">/</span><span class="mi">4915200</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">259</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">7</span><span class="p">))))</span> <span class="o">+</span> <span class="mi">142369920</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> \
    <span class="o">*</span> <span class="p">(</span><span class="mi">24608</span> <span class="o">+</span> <span class="p">(</span><span class="mi">89024</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">42884</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1719</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">6</span><span class="p">))))</span> \
    <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eta</span><span class="p">))))))))))))</span>

    
    <span class="n">dydt</span> <span class="o">=</span> <span class="p">(</span><span class="n">zero_pnterm_u</span><span class="o">*</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span> <span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">9</span>  <span class="o">+</span><span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">one_pnterm_u</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">11</span>\
        <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">oneptfive_pnterm_u</span> <span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">12</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">two_pnterm_u</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="mi">13</span> \
        <span class="o">+</span> <span class="p">(</span><span class="mf">2.5</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">twoptfive_pnterm_u</span> <span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">14</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">three_pnterm_u</span> <span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">15</span><span class="p">)</span> 
        
    <span class="n">de2dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">zero_pnterm_e</span><span class="o">*</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span> <span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">8</span>  <span class="o">+</span><span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">one_pnterm_e</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">10</span>\
        <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">oneptfive_pnterm_e</span> <span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">11</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">two_pnterm_e</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="mi">12</span> \
        <span class="o">+</span> <span class="p">(</span><span class="mf">2.5</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">twoptfive_pnterm_e</span> <span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">13</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="ow">in</span> <span class="n">PNorderrad</span><span class="p">)</span><span class="o">*</span><span class="n">three_pnterm_e</span> <span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">14</span><span class="p">)</span><span class="c1">#/(2*e)</span>
    <span class="c1">#print(de2dt)</span>

    <span class="n">dadt</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dydt</span><span class="o">*</span><span class="n">eta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">e</span><span class="o">*</span><span class="n">de2dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># precession of line of periastron  from Klein et al. 2018  arXiv:1801.08542 [Eq. 17b]</span>
    <span class="n">ddelta_lambdadt</span> <span class="o">=</span> <span class="mi">96</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">12</span>  <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Integrate in a, not in time</span>
    <span class="n">dtda</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dadt</span>
    <span class="n">dLhda</span> <span class="o">=</span> <span class="n">dLhdt</span><span class="o">*</span><span class="n">dtda</span>
    <span class="n">dS1hda</span> <span class="o">=</span> <span class="n">dS1hdt</span><span class="o">*</span><span class="n">dtda</span>
    <span class="n">dS2hda</span> <span class="o">=</span> <span class="n">dS2hdt</span><span class="o">*</span><span class="n">dtda</span>
    <span class="n">ddelta_lambdada</span> <span class="o">=</span> <span class="n">ddelta_lambdadt</span><span class="o">*</span><span class="n">dtda</span>

    <span class="n">de2da</span> <span class="o">=</span> <span class="n">de2dt</span><span class="o">*</span><span class="n">dtda</span>

    <span class="c1"># Pack outputs</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">dLhda</span><span class="p">,</span> <span class="n">dS1hda</span><span class="p">,</span> <span class="n">dS2hda</span><span class="p">,</span>  <span class="p">[</span><span class="n">ddelta_lambdada</span><span class="p">],</span> <span class="p">[</span><span class="n">de2da</span><span class="p">],</span> <span class="p">[</span><span class="n">dtda</span><span class="p">]])</span></div>


<div class="viewcode-block" id="integrator_orbav">
<a class="viewcode-back" href="../eccentric.html#eccentricity.integrator_orbav">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">integrator_orbav</span><span class="p">(</span><span class="n">Lhinitial</span><span class="p">,</span> <span class="n">S1hinitial</span><span class="p">,</span> <span class="n">S2hinitial</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="p">,</span> <span class="n">a</span> <span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">PNorderpre</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">PNorderrad</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">odeint_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integration of the systems of ODEs describing orbit-averaged inspirals.</span>
<span class="sd">    Additional keywords arguments are passed to `scipy.integrate.odeint` after some custom-made default settings.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Lhinitial: array</span>
<span class="sd">        Initial direction of the orbital angular momentum, unit vector.</span>
<span class="sd">    S1hinitial: array</span>
<span class="sd">        Initial direction of the primary spin, unit vector.</span>
<span class="sd">    S2hinitial: array</span>
<span class="sd">        Initial direction of the secondary spin, unit vector.</span>
<span class="sd">    a: float</span>
<span class="sd">       Bianary semi-major axis.</span>
<span class="sd">    e : float</span>
<span class="sd">       Eccentricty: 0&lt;=e&lt;1. .</span>
<span class="sd">    q: float</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    chi1: float</span>
<span class="sd">        Dimensionless spin of the primary (heavier) black hole: 0&lt;=chi1&lt;=1.</span>
<span class="sd">    chi2: float</span>
<span class="sd">        Dimensionless spin of the secondary (lighter) black hole: 0&lt;=chi2&lt;=1.</span>
<span class="sd">    PNorderpre: array (default: [0,0.5])</span>
<span class="sd">        PN orders considered in the spin-precession equations.</span>
<span class="sd">    PNorderrad: array (default: [0,0.5])</span>
<span class="sd">        PN orders considered in the radiation-reaction equation.</span>
<span class="sd">    **odeint_kwargs: unpacked dictionary, optional</span>
<span class="sd">        Additional keyword arguments.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ODEsolution: array</span>
<span class="sd">        Solution of the ODE.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``ODEsolution = precession.integrator_orbavintegrator_orbav(Lhinitial,S1hinitial,S2hinitial,v,q,chi1,chi2)``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Lhinitial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">Lhinitial</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">S1hinitial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">S1hinitial</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">S2hinitial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">S2hinitial</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">delta_lambda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">delta_lambda</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">delta_lambda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">delta_lambda</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Defaults for the integrators, can be changed by the user</span>
    <span class="k">if</span> <span class="s1">&#39;mxstep&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">odeint_kwargs</span><span class="p">:</span> <span class="n">odeint_kwargs</span><span class="p">[</span><span class="s1">&#39;mxstep&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">5000000</span>
    <span class="k">if</span> <span class="s1">&#39;rol&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">odeint_kwargs</span><span class="p">:</span> <span class="n">odeint_kwargs</span><span class="p">[</span><span class="s1">&#39;rtol&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">1e-13</span>
    <span class="k">if</span> <span class="s1">&#39;aol&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">odeint_kwargs</span><span class="p">:</span> <span class="n">odeint_kwargs</span><span class="p">[</span><span class="s1">&#39;atol&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">1e-13</span>
    <span class="n">odeint_kwargs</span><span class="p">[</span><span class="s1">&#39;full_output&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># This needs to be forced for compatibility with the rest of the code</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute</span><span class="p">(</span><span class="n">Lhinitial</span><span class="p">,</span> <span class="n">S1hinitial</span><span class="p">,</span> <span class="n">S2hinitial</span><span class="p">,</span><span class="n">delta_lambda</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">):</span>

        <span class="c1"># I need unit vectors</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">Lhinitial</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">S1hinitial</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">S2hinitial</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
       

        <span class="c1"># Pack inputs</span>
    
        <span class="n">ic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">Lhinitial</span><span class="p">,</span> <span class="n">S1hinitial</span><span class="p">,</span> <span class="n">S2hinitial</span><span class="p">,[</span><span class="n">delta_lambda</span><span class="p">],</span> <span class="p">[</span><span class="n">e</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="c1"># Compute these quantities here instead of inside the RHS for speed</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">eval_m1</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">eval_m2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">S1</span> <span class="o">=</span> <span class="n">eval_S1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">S2</span> <span class="o">=</span> <span class="n">eval_S2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">chi2</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">eval_eta</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="c1"># solve_ivp implementation. Didn&#39;t really work.</span>
        <span class="c1">#ODEsolution = scipy.integrate.solve_ivp(rhs_orbav, (vinitial, vfinal), ic, method=&#39;LSODA&#39;, t_eval=(vinitial, vfinal), dense_output=True, args=(q, m1, m2, eta, chi1, chi2, S1, S2, quadrupole_formula),rtol=1e-12,atol=1e-12)</span>
        <span class="c1">#ODEsolution = scipy.integrate.solve_ivp(rhs_orbav, (vinitial, vfinal), ic, t_eval=(vinitial, vfinal), dense_output=True, args=(q, m1, m2, eta, chi1, chi2, S1, S2, quadrupole_formula))</span>

        <span class="n">ODEsolution</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">odeint</span><span class="p">(</span><span class="n">rhs_orbav</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">PNorderpre</span><span class="p">,</span> <span class="n">PNorderrad</span><span class="p">),</span> <span class="o">**</span><span class="n">odeint_kwargs</span><span class="p">)</span><span class="c1">#, printmessg=0,rtol=1e-10,atol=1e-10)#,tcrit=sing)</span>
        <span class="k">return</span> <span class="n">ODEsolution</span>

    <span class="n">ODEsolution</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_compute</span><span class="p">,</span> <span class="n">Lhinitial</span><span class="p">,</span> <span class="n">S1hinitial</span><span class="p">,</span> <span class="n">S2hinitial</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">ODEsolution</span></div>


<div class="viewcode-block" id="inspiral_orbav">
<a class="viewcode-back" href="../eccentric.html#eccentricity.inspiral_orbav">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">inspiral_orbav</span><span class="p">(</span><span class="n">theta1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theta2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deltaphi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Lh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">S1h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">S2h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">deltachi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chieff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chi1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chi2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cyclesign</span><span class="o">=+</span><span class="mi">1</span><span class="p">,</span> <span class="n">PNorderpre</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">PNorderrad</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">3.5</span><span class="p">],</span> <span class="n">requested_outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">odeint_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform precession-averaged inspirals. The variables q, chi1, and chi2 must always be provided.</span>
<span class="sd">    The integration range must be specified using either (a,e) or (uc,u) (and not both). These need to be arrays with lenght &gt;=1, where e.g. a[0] corresponds to the initial condition and a[1:] corresponds to the location where outputs are returned.</span>
<span class="sd">    The function is vectorized: evolving N multiple binaries with M outputs requires kappainitial, chieff, q, chi1, chi2 to be of shape (N,) and uc of shape (M,N).</span>
<span class="sd">    The initial conditions must be specified in terms of one an only one of the following:</span>
<span class="sd">        - Lh, S1h, and S2h</span>
<span class="sd">        - theta1,theta2, and deltaphi.</span>
<span class="sd">        - deltachi, kappa, chieff, cyclesign.</span>
<span class="sd">    The desired outputs can be specified with a list e.g. requested_outputs=[&#39;theta1&#39;,&#39;theta2&#39;,&#39;deltaphi&#39;]. All the available variables are returned by default. These are: [&#39;theta1&#39;, &#39;theta2&#39;, &#39;deltaphi&#39;, &#39;deltachi&#39;, &#39;kappa&#39;, &#39;r&#39;, &#39;u&#39;, &#39;deltachiminus&#39;, &#39;deltachiplus&#39;, &#39;deltachi3&#39;, &#39;chieff&#39;, &#39;q&#39;, &#39;chi1&#39;, &#39;chi2&#39;].</span>
<span class="sd">    The flag enforce allows checking the consistency of the input variables.</span>
<span class="sd">    Additional keywords arguments are passed to `scipy.integrate.odeint` after some custom-made default settings.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta1: float, optional (default: None)</span>
<span class="sd">        Angle between orbital angular momentum and primary spin.</span>
<span class="sd">    theta2: float, optional (default: None)</span>
<span class="sd">        Angle between orbital angular momentum and secondary spin.</span>
<span class="sd">    deltaphi: float, optional (default: None)</span>
<span class="sd">        Angle between the projections of the two spins onto the orbital plane.</span>
<span class="sd">    Lh: array, optional (default: None)</span>
<span class="sd">        Direction of the orbital angular momentum, unit vector.</span>
<span class="sd">    S1h: array, optional (default: None)</span>
<span class="sd">        Direction of the primary spin, unit vector.</span>
<span class="sd">    S2h: array, optional (default: None)</span>
<span class="sd">        Direction of the secondary spin, unit vector.</span>
<span class="sd">    deltachi: float, optional (default: None)</span>
<span class="sd">        Weighted spin difference.</span>
<span class="sd">    kappa: float, optional (default: None)</span>
<span class="sd">        Asymptotic angular momentum.</span>
<span class="sd">    a: float, optional (default: None)</span>
<span class="sd">        Binary semi-major axis.</span>
<span class="sd">    e: float, optional (default: None)</span>
<span class="sd">        Eccentricity 0&lt;=e&lt;1.    </span>
<span class="sd">    uc: float, optional (default: None)</span>
<span class="sd">        Circualr compactified separation 1/(2L(e=0)).</span>
<span class="sd">    u: float, optional (default: None)</span>
<span class="sd">        Compactified separation 1/(2L).</span>
<span class="sd">    chieff: float, optional (default: None)</span>
<span class="sd">        Effective spin.</span>
<span class="sd">    q: float, optional (default: None)</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    chi1: float, optional (default: None)</span>
<span class="sd">        Dimensionless spin of the primary (heavier) black hole: 0&lt;=chi1&lt;=1.</span>
<span class="sd">    chi2: float, optional (default: None)</span>
<span class="sd">        Dimensionless spin of the secondary (lighter) black hole: 0&lt;=chi2&lt;=1.</span>
<span class="sd">    cyclesign: integer, optional (default: +1)</span>
<span class="sd">        Sign (either +1 or -1) to cover the two halves of a precesion cycle.</span>
<span class="sd">    PNorderpre: array (default: [0,0.5])</span>
<span class="sd">        PN orders considered in the spin-precession equations.</span>
<span class="sd">    PNorderrad: array (default: [0,0.5])</span>
<span class="sd">        PN orders considered in the radiation-reaction equation.</span>
<span class="sd">    requested_outputs: list, optional (default: None)</span>
<span class="sd">        Set of outputs.</span>
<span class="sd">    **odeint_kwargs: unpacked dictionary, optional</span>
<span class="sd">        Additional keyword arguments.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    outputs: dictionary</span>
<span class="sd">        Set of outputs.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``outputs = precession.inspiral_orbav(Lh=Lh,S1h=S1h,S2h=S2h,a=a,e=e,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_orbav(Lh=Lh,S1h=S1h,S2h=S2h,uc=uc,u=u,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_orbav(theta1=theta1,theta2=theta2,deltaphi=deltaphi,a=a,e=e,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_orbav(theta1=theta1,theta2=theta2,deltaphi=deltaphi,uc=uc,u=u,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_orbav(deltachi=deltachi,kappa=kappa,a=a,e=e,chieff=chieff,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    

    <span class="c1"># Substitute None inputs with arrays of Nones</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">Lh</span><span class="p">,</span> <span class="n">S1h</span><span class="p">,</span> <span class="n">S2h</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tiler</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>  <span class="c1"># Lh, S1h, S2h, a or uc</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Any of the others</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">Lh</span><span class="p">,</span> <span class="n">S1h</span><span class="p">,</span> <span class="n">S2h</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="o">=</span> <span class="n">inputs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">Lh</span><span class="p">,</span> <span class="n">S1h</span><span class="p">,</span> <span class="n">S2h</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">cyclesign</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">chi1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">chi2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please provide q, chi1, and chi2.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">ismonotonic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">ismonotonic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">)),</span> <span class="s1">&#39;a must be monotonic&#39;</span>
            <span class="n">uc</span> <span class="o">=</span> <span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">tiler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>  <span class="c1"># Convert a in uc to uc </span>
            
        <span class="k">elif</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">ismonotonic</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">ismonotonic</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">)),</span> <span class="s1">&#39;uc must be monotonic&#39;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">eval_a</span><span class="p">(</span><span class="n">uc</span><span class="o">=</span><span class="n">uc</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">uc</span><span class="p">))</span>  <span class="c1"># Convert uc in a to a </span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please provide either a or uc.&quot;</span><span class="p">)</span>

        <span class="c1"># User provides Lh, S1h, and S2h</span>
        <span class="k">if</span> <span class="n">Lh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">S1h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">S2h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">theta1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">theta2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deltaphi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deltachi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kappa</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chieff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># User provides theta1, theta2, and deltaphi.</span>
        <span class="k">elif</span> <span class="n">Lh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">S1h</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">S2h</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">theta1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">theta2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deltaphi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deltachi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kappa</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chieff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Lh</span><span class="p">,</span> <span class="n">S1h</span><span class="p">,</span> <span class="n">S2h</span> <span class="o">=</span> <span class="n">angles_to_Lframe</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">)</span>
            


        <span class="c1"># User provides deltachi, kappa, and chieff.</span>
        <span class="k">elif</span> <span class="n">Lh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">S1h</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">S2h</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">theta1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">theta2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deltaphi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deltachi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kappa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chieff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
             <span class="c1">#cyclesign=+1 by default</span>
            <span class="n">Lh</span><span class="p">,</span> <span class="n">S1h</span><span class="p">,</span> <span class="n">S2h</span> <span class="o">=</span> <span class="n">conserved_to_Lframe</span><span class="p">(</span><span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">cyclesign</span><span class="o">=</span><span class="n">cyclesign</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please provide one and not more of the following: (Lh,S1h,S2h), (theta1,theta2,deltaphi), (deltachi,kappa,chieff).&quot;</span><span class="p">)</span>

        <span class="c1"># Make sure vectors are normalized</span>
        <span class="n">Lh</span> <span class="o">=</span> <span class="n">Lh</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">Lh</span><span class="p">)</span>
        <span class="n">S1h</span> <span class="o">=</span> <span class="n">S1h</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">S1h</span><span class="p">)</span>
        <span class="n">S2h</span> <span class="o">=</span> <span class="n">S2h</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">S2h</span><span class="p">)</span>

        

        <span class="c1"># Integration</span>
        <span class="n">evaluations</span> <span class="o">=</span> <span class="n">integrator_orbav</span><span class="p">(</span><span class="n">Lh</span><span class="p">,</span> <span class="n">S1h</span><span class="p">,</span> <span class="n">S2h</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">PNorderpre</span><span class="o">=</span><span class="n">PNorderpre</span><span class="p">,</span> <span class="n">PNorderrad</span><span class="o">=</span><span class="n">PNorderrad</span><span class="p">,</span><span class="o">**</span><span class="n">odeint_kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># For solve_ivp implementation</span>
        <span class="c1">#evaluations = np.squeeze(ODEsolution.item().sol(v))</span>

        <span class="c1"># Returned output is</span>
        <span class="c1"># Lx, Ly, Lz, S1x, S1y, S1z, S2x, S2y, S2z, delta_lambda, e, (t)</span>
        <span class="n">Lh</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">S1h</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">S2h</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">delta_lambda</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">evaluations</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Renormalize. The normalization is not enforced by the integrator, it is only maintaied within etamerical accuracy.</span>
        <span class="c1">#Lh = Lh/np.linalg.norm(Lh)</span>
        <span class="c1">#S1h = S1h/np.linalg.norm(S1h)</span>
        <span class="c1">#S2h = S2h/np.linalg.norm(S2h)</span>

        <span class="n">S1</span> <span class="o">=</span> <span class="n">eval_S1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">)</span>
        <span class="n">S2</span> <span class="o">=</span> <span class="n">eval_S2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">chi2</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">eval_L</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
        <span class="n">Lvec</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">Lh</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">S1vec</span> <span class="o">=</span> <span class="n">S1</span><span class="o">*</span><span class="n">S1h</span>
        <span class="n">S2vec</span> <span class="o">=</span> <span class="n">S2</span><span class="o">*</span><span class="n">S2h</span>
        <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span> <span class="o">=</span> <span class="n">vectors_to_angles</span><span class="p">(</span><span class="n">Lvec</span><span class="p">,</span> <span class="n">S1vec</span><span class="p">,</span> <span class="n">S2vec</span><span class="p">)</span>
        <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">cyclesign</span> <span class="o">=</span> <span class="n">vectors_to_conserved</span><span class="p">(</span><span class="n">Lvec</span><span class="p">,</span> <span class="n">S1vec</span><span class="p">,</span> <span class="n">S2vec</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">),</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">u</span><span class="o">=</span> <span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>  <span class="c1"># Convert a in u to u using the tiler function</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">Lh</span><span class="p">,</span> <span class="n">S1h</span><span class="p">,</span> <span class="n">S2h</span><span class="p">,</span> <span class="n">delta_lambda</span> <span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">cyclesign</span>

    <span class="c1"># This array has to match the outputs of _compute (in the right order!)</span>
    <span class="n">alloutputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;theta1&#39;</span><span class="p">,</span> <span class="s1">&#39;theta2&#39;</span><span class="p">,</span> <span class="s1">&#39;deltaphi&#39;</span><span class="p">,</span> <span class="s1">&#39;Lh&#39;</span><span class="p">,</span> <span class="s1">&#39;S1h&#39;</span><span class="p">,</span> <span class="s1">&#39;S2h&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_lambda&#39;</span><span class="p">,</span><span class="s1">&#39;deltachi&#39;</span><span class="p">,</span> <span class="s1">&#39;kappa&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;uc&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;chieff&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">,</span> <span class="s1">&#39;cyclesign&#39;</span><span class="p">])</span>


    <span class="k">if</span> <span class="n">cyclesign</span> <span class="o">==+</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">cyclesign</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">cyclesign</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">tiler</span><span class="p">(</span><span class="n">cyclesign</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
    
    <span class="c1"># Here I force dtype=object because the outputs have different shapes</span>
    <span class="n">allresults</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_compute</span><span class="p">,</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">Lh</span><span class="p">,</span> <span class="n">S1h</span><span class="p">,</span> <span class="n">S2h</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">cyclesign</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Handle the outputs.</span>
    <span class="c1"># Return all</span>
    <span class="k">if</span> <span class="n">requested_outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">requested_outputs</span> <span class="o">=</span> <span class="n">alloutputs</span>
    <span class="c1"># Return only those requested (in1d return boolean array)</span>
    <span class="n">wantoutputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">alloutputs</span><span class="p">,</span> <span class="n">requested_outputs</span><span class="p">)</span>

    <span class="c1"># Store into a dictionary</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">alloutputs</span><span class="p">[</span><span class="n">wantoutputs</span><span class="p">],</span> <span class="n">allresults</span><span class="p">[</span><span class="n">wantoutputs</span><span class="p">]):</span>
        <span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;chi1&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;chi2&#39;</span><span class="p">:</span>  <span class="c1"># Constants of motion (chieff is not enforced!)</span>
            <span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">outcome</span></div>


<div class="viewcode-block" id="inspiral_hybrid">
<a class="viewcode-back" href="../eccentric.html#eccentricity.inspiral_hybrid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">inspiral_hybrid</span><span class="p">(</span><span class="n">theta1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theta2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deltaphi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deltachi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aswitch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ucswitch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chieff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chi1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chi2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">requested_outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">odeint_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform hybrid inspirals, i.e. evolve the binary at large separation with a pression-averaged evolution and at small separation with an orbit-averaged evolution, matching the two. The variables q, chi1, and chi2 must always be provided. The integration range must be specified using either a or uc (and not both); provide also ucswitch and aswitch consistently.</span>
<span class="sd">    Either a of uc needs to be arrays with lenght &gt;=1, where e.g. a[0] corresponds to the initial condition and a[1:] corresponds to the location where outputs are returned. It does not work at past time infinity if e !=0.</span>
<span class="sd">    The function is vectorized: evolving N multiple binaries with M outputs requires kappainitial, chieff, q, chi1, chi2 to be of shape (N,) and u of shape (M,N).</span>
<span class="sd">    The initial conditions must be specified in terms of one an only one of the following:</span>
<span class="sd">        - theta1,theta2, and deltaphi (but note that deltaphi is not necessary if integrating from infinite separation).</span>
<span class="sd">        - kappa, chieff.</span>
<span class="sd">    The desired outputs can be specified with a list e.g. requested_outputs=[&#39;theta1&#39;,&#39;theta2&#39;,&#39;deltaphi&#39;]. All the available variables are returned by default. These are: [&#39;theta1&#39;, &#39;theta2&#39;, &#39;deltaphi&#39;, &#39;deltachi&#39;, &#39;kappa&#39;, &#39;a&#39;,&#39;e&#39;, &#39;uc&#39;,&#39;u&#39;, &#39;deltachiminus&#39;, &#39;deltachiplus&#39;, &#39;deltachi3&#39;, &#39;chieff&#39;, &#39;q&#39;, &#39;chi1&#39;, &#39;chi2&#39;].</span>
<span class="sd">    The flag enforce allows checking the consistency of the input variables.</span>
<span class="sd">    Additional keywords arguments are passed to `scipy.integrate.odeint` after some custom-made default settings.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta1: float, optional (default: None)</span>
<span class="sd">        Angle between orbital angular momentum and primary spin.</span>
<span class="sd">    theta2: float, optional (default: None)</span>
<span class="sd">        Angle between orbital angular momentum and secondary spin.</span>
<span class="sd">    deltaphi: float, optional (default: None)</span>
<span class="sd">        Angle between the projections of the two spins onto the orbital plane.</span>
<span class="sd">    deltachi: float, optional (default: None)</span>
<span class="sd">        Weighted spin difference.</span>
<span class="sd">    kappa: float, optional (default: None)</span>
<span class="sd">        Asymptotic angular momentum.</span>
<span class="sd">    a: float, optional (default: None)</span>
<span class="sd">        Binary semi-major axis.</span>
<span class="sd">    e: float, optional (default: None)</span>
<span class="sd">        Binary eccentricity: 0&lt;=e&lt;1 .</span>
<span class="sd">    aswitch: float, optional (default: None)</span>
<span class="sd">        Matching separation between the precession- and orbit-averaged chunks.</span>
<span class="sd">    eswitch: float, optional (default: None)</span>
<span class="sd">        Matching separation between the precession- and orbit-averaged chunks.    </span>
<span class="sd">    u: float, optional (default: None)</span>
<span class="sd">        Compactified separation 1/(2L).</span>
<span class="sd">    uc: float, optional (default: None)</span>
<span class="sd">        Compactified circular separation 1/(2L).    </span>
<span class="sd">    uswitch: float, optional (default: None)</span>
<span class="sd">        Matching compactified separation between the precession- and orbit-averaged chunks.</span>
<span class="sd">    chieff: float, optional (default: None)</span>
<span class="sd">        Effective spin.</span>
<span class="sd">    q: float, optional (default: None)</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    chi1: float, optional (default: None)</span>
<span class="sd">        Dimensionless spin of the primary (heavier) black hole: 0&lt;=chi1&lt;=1.</span>
<span class="sd">    chi2: float, optional (default: None)</span>
<span class="sd">        Dimensionless spin of the secondary (lighter) black hole: 0&lt;=chi2&lt;=1.</span>
<span class="sd">    requested_outputs: list, optional (default: None)</span>
<span class="sd">        Set of outputs.</span>
<span class="sd">    **odeint_kwargs: unpacked dictionary, optional</span>
<span class="sd">        Additional keyword arguments.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    outputs: dictionary</span>
<span class="sd">        Set of outputs.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``outputs = precession.inspiral_hybrid(theta1=theta1,theta2=theta2,deltaphi=deltaphi,a=a,e=e,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_hybrid(theta1=theta1,theta2=theta2,deltaphi=deltaphi,uc=uc,u=u,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_hybrid(kappa,a=a,e=e,chieff=chieff,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    ``outputs = precession.inspiral_hybrid(kappa,uc=uc,u=u,chieff=chieff,q=q,chi1=chi1,chi2=chi2)``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Outputs available in both orbit-averaged and precession-averaged evolutions</span>
    <span class="n">alloutputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;theta1&#39;</span><span class="p">,</span> <span class="s1">&#39;theta2&#39;</span><span class="p">,</span> <span class="s1">&#39;deltaphi&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachi&#39;</span><span class="p">,</span> <span class="s1">&#39;kappa&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;uc&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;chieff&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">requested_outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">requested_outputs</span> <span class="o">=</span> <span class="n">alloutputs</span>
        <span class="c1"># Return only those requested (in1d return boolean array)</span>
    <span class="n">wantoutputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">alloutputs</span><span class="p">,</span> <span class="n">requested_outputs</span><span class="p">)</span>

    <span class="c1"># Substitute None inputs with arrays of Nones</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">aswitch</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">ucswitch</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tiler</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span><span class="mi">8</span> <span class="p">:</span>  <span class="c1"># Either u or r</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Any of the others</span>
                <span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">aswitch</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">ucswitch</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span> <span class="o">=</span> <span class="n">inputs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">aswitch</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span><span class="n">ucswitch</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">):</span>
        <span class="n">estart</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Ensure estart is always defined</span>
        <span class="c1">## User pass (uc, u0, ucswitch) -&gt; return a,eswictch, uswitch</span>
        
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">aswitch</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ucswitch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">eval_a</span><span class="p">(</span><span class="n">uc</span><span class="o">=</span><span class="n">uc</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">uc</span><span class="p">))</span>
            <span class="n">e0</span><span class="o">=</span> <span class="n">eval_e</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span><span class="n">uc</span><span class="o">=</span><span class="n">uc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
            <span class="n">estart</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e0</span><span class="p">)</span>
            <span class="n">aswitch</span> <span class="o">=</span> <span class="n">eval_a</span><span class="p">(</span><span class="n">uc</span><span class="o">=</span><span class="n">ucswitch</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">tiler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">ucswitch</span><span class="p">))</span>
            <span class="n">uc0</span><span class="o">=</span><span class="n">uc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
                     <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span> <span class="p">:</span> <span class="n">implicit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">uc</span><span class="p">)</span> <span class="o">-</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">uc</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">)</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">implicit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">uc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
            <span class="n">uswitch</span><span class="o">=</span><span class="n">solve</span><span class="p">(</span><span class="n">ucswitch</span><span class="p">,</span><span class="n">c0</span><span class="p">,</span><span class="n">e0</span><span class="p">)</span>
            <span class="n">eswitch</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ucswitch</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">uswitch</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
      

        <span class="c1">## User pass (a, e0, aswitch) -&gt; return eswitch uswitch and  ucswitch</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">aswitch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ucswitch</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">e0</span><span class="o">=</span><span class="n">e</span>
            <span class="n">estart</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
            <span class="n">uc0</span><span class="o">=</span><span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
            <span class="n">ucswitch</span><span class="o">=</span> <span class="n">eval_u</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">aswitch</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please provide either a or uc.&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_2_step</span><span class="p">(</span><span class="n">uc0</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">ucswitch</span><span class="p">,</span><span class="n">e0</span><span class="p">):</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
                     <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span> <span class="p">:</span> <span class="n">implicit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">uc</span><span class="p">)</span> <span class="o">-</span> <span class="n">c0</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">uc</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">)</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">implicit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">uc0</span><span class="p">)</span> 
            <span class="n">uswitch</span><span class="o">=</span><span class="n">solve</span><span class="p">(</span><span class="n">ucswitch</span><span class="p">,</span><span class="n">c0</span><span class="p">,</span><span class="n">e0</span><span class="p">)</span>
            <span class="n">eswitch</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ucswitch</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">uswitch</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">uswitch</span><span class="p">,</span> <span class="n">eswitch</span>
        
        <span class="n">uswitch</span><span class="p">,</span> <span class="n">eswitch</span><span class="o">=</span> <span class="n">_2_step</span><span class="p">(</span><span class="n">uc0</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">ucswitch</span><span class="p">,</span><span class="n">e0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;uswitch, eswitch&quot;</span><span class="p">,</span> <span class="n">uswitch</span><span class="p">,</span> <span class="n">eswitch</span><span class="p">)</span>

        <span class="n">forward</span> <span class="o">=</span> <span class="n">ismonotonic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;&gt;=&quot;</span><span class="p">)</span>
        <span class="n">backward</span> <span class="o">=</span> <span class="n">ismonotonic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">forward</span><span class="p">,</span> <span class="n">backward</span><span class="p">),</span> <span class="s2">&quot;a must be monotonic&quot;</span>
        <span class="k">assert</span> <span class="n">aswitch</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">aswitch</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="s2">&quot;The switching condition must to be within the range spanned by a.&quot;</span>

        <span class="n">alarge</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="n">aswitch</span><span class="p">]</span>
        <span class="n">asmall</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">aswitch</span><span class="p">]</span>


        <span class="c1"># Integrating forward: precession-averaged first, then orbit-averaged</span>
        <span class="k">if</span> <span class="n">forward</span><span class="p">:</span>
            <span class="n">inspiral_first</span> <span class="o">=</span> <span class="n">inspiral_precav</span>
            <span class="n">afirst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alarge</span><span class="p">,</span> <span class="n">aswitch</span><span class="p">)</span>
            <span class="n">inspiral_second</span> <span class="o">=</span> <span class="n">inspiral_orbav</span>
            <span class="n">asecond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aswitch</span><span class="p">,</span> <span class="n">asmall</span><span class="p">)</span>

        <span class="c1"># Integrating backward: orbit-averaged first, then precession-averaged</span>
        <span class="k">elif</span> <span class="n">backward</span><span class="p">:</span>
            <span class="n">inspiral_first</span> <span class="o">=</span> <span class="n">inspiral_orbav</span>
            <span class="n">afirst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asmall</span><span class="p">,</span> <span class="n">aswitch</span><span class="p">)</span>
            <span class="n">inspiral_second</span> <span class="o">=</span> <span class="n">inspiral_precav</span>
            <span class="n">asecond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aswitch</span><span class="p">,</span> <span class="n">alarge</span><span class="p">)</span>

        <span class="c1"># First chunk of the evolution</span>
        <span class="n">evolution_first</span> <span class="o">=</span> <span class="n">inspiral_first</span><span class="p">(</span><span class="n">theta1</span><span class="o">=</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="o">=</span><span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="o">=</span><span class="n">deltaphi</span><span class="p">,</span> <span class="n">deltachi</span><span class="o">=</span><span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">afirst</span><span class="p">,</span><span class="n">e</span><span class="o">=</span><span class="n">estart</span><span class="p">,</span> <span class="n">chieff</span><span class="o">=</span><span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="o">=</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="o">=</span><span class="n">chi2</span><span class="p">,</span> <span class="n">requested_outputs</span><span class="o">=</span><span class="n">alloutputs</span><span class="p">,</span><span class="o">**</span><span class="n">odeint_kwargs</span><span class="p">)</span>

        <span class="c1"># Second chunk of the evolution</span>
        <span class="n">evolution_second</span> <span class="o">=</span> <span class="n">inspiral_second</span><span class="p">(</span><span class="n">theta1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">evolution_first</span><span class="p">[</span><span class="s1">&#39;theta1&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">theta2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">evolution_first</span><span class="p">[</span><span class="s1">&#39;theta2&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">deltaphi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">evolution_first</span><span class="p">[</span><span class="s1">&#39;deltaphi&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="o">=</span><span class="n">asecond</span><span class="p">,</span><span class="n">e</span><span class="o">=</span><span class="n">eswitch</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="o">=</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="o">=</span><span class="n">chi2</span><span class="p">,</span> <span class="n">requested_outputs</span><span class="o">=</span><span class="n">alloutputs</span><span class="p">,</span><span class="o">**</span><span class="n">odeint_kwargs</span><span class="p">)</span>

        <span class="c1"># Store outputs</span>
        <span class="n">evolution_full</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">wantoutputs</span><span class="p">:</span>
            <span class="c1"># Quantities that vary in both the precession-averaged and the orbit-averaged evolution</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;theta1&#39;</span><span class="p">,</span> <span class="s1">&#39;theta2&#39;</span><span class="p">,</span> <span class="s1">&#39;deltaphi&#39;</span><span class="p">,</span> <span class="s1">&#39;deltachi&#39;</span><span class="p">,</span> <span class="s1">&#39;kappa&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;uc&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">]:</span>
                <span class="n">evolution_full</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">evolution_first</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">evolution_second</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">:]))</span>
            <span class="c1"># Quantities that vary only on the orbit-averaged evolution</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;chieff&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">forward</span><span class="p">:</span>
                    <span class="n">evolution_full</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tiler</span><span class="p">(</span><span class="n">evolution_first</span><span class="p">[</span><span class="n">k</span><span class="p">][:],</span> <span class="n">afirst</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">evolution_second</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">:]))</span>
                <span class="k">elif</span> <span class="n">backward</span><span class="p">:</span>
                    <span class="n">evolution_full</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">evolution_first</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tiler</span><span class="p">(</span><span class="n">evolution_second</span><span class="p">[</span><span class="n">k</span><span class="p">][:],</span> <span class="n">asecond</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
            <span class="c1"># Quanties that do not vary</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">]:</span>
                <span class="n">evolution_full</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">evolution_second</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">evolution_full</span>

    <span class="n">allresults</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_compute</span><span class="p">,</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">deltachi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">aswitch</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span><span class="n">ucswitch</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">chieff</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">))</span>
    <span class="n">evolution_full</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">allresults</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">evolution_full</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">evolution_full</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">evolution_full</span> <span class="ow">in</span> <span class="n">allresults</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">evolution_full</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">omega_to_a</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">PNorder</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">2</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert orbit-avareged orbital frequency (in Hz) to semi-major axis (in natural units, c=G=M=1).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta1: float</span>
<span class="sd">        Angle between orbital angular momentum and primary spin.</span>
<span class="sd">    theta2: float</span>
<span class="sd">        Angle between orbital angular momentum and secondary spin.</span>
<span class="sd">    deltaphi: float</span>
<span class="sd">        Angle between the projections of the two spins onto the orbital plane.</span>
<span class="sd">    omega: float</span>
<span class="sd">        orbit-avareged orbital frequency</span>
<span class="sd">    e: float</span>
<span class="sd">        eccentricity: 0&lt;=e&lt;1.   </span>
<span class="sd">    q: float</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    chi1: float</span>
<span class="sd">        Dimensionless spin of the primary (heavier) black hole: 0&lt;=chi1&lt;=1.</span>
<span class="sd">    chi2: float</span>
<span class="sd">        Dimensionless spin of the secondary (lighter) black hole: 0&lt;=chi2&lt;=1.</span>
<span class="sd">    PNorder: array (default: [0,1,1.5,2])</span>
<span class="sd">        PN orders considered.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r: float</span>
<span class="sd">        Binary separation.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``a = precession.omega_to_a(theta1,theta2,deltaphi,omega,e,q,chi1,chi2,PNorder=[0,1,1.5,2])``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">theta1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">theta2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">deltaphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1">#PN terms ( Kidder et al. 2018 Eq. B2a)</span>
    <span class="n">A1</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> \
    <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">9</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">17</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">q</span><span class="p">))))</span>
    <span class="n">A1p5</span><span class="o">=-</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="p">)))</span> <span class="o">*</span> <span class="n">chi1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">q</span><span class="p">)))</span> <span class="o">*</span> <span class="n">chi2</span><span class="p">)</span>
    <span class="n">A2</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">36</span> <span class="o">*</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">36</span> <span class="o">+</span> \
    <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">159</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">250</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">53</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">q</span><span class="p">))))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> \
    <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">936</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">648</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">91</span> <span class="o">+</span> <span class="p">(</span><span class="mi">72</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="o">-</span><span class="mi">6</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1282</span> <span class="o">+</span> <span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">91</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span> \
    <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">18</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span> <span class="o">*</span> <span class="n">chi1</span> <span class="o">*</span> <span class="n">chi2</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> \
    <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))))))</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="mi">42</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> \
    <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">936</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="p">(</span><span class="mi">648</span> <span class="o">*</span> \
    <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">180</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">692</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">179</span> <span class="o">+</span> <span class="mi">63</span> <span class="o">*</span> <span class="n">q</span><span class="p">))</span> \
    <span class="o">+</span> <span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="mi">179</span> <span class="o">+</span> <span class="p">(</span><span class="mi">108</span> <span class="o">*</span> \
    <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">18</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span> \
    <span class="o">*</span> <span class="n">chi1</span> <span class="o">*</span> <span class="n">chi2</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))))))))))</span>

    <span class="n">a</span> <span class="o">=</span>  <span class="n">omega</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">PNorder</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> 
        <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">PNorder</span><span class="p">)</span> <span class="o">*</span> <span class="n">omega</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">A1</span> <span class="p">)</span> 
        <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span> <span class="ow">in</span> <span class="n">PNorder</span><span class="p">)</span> <span class="o">*</span> <span class="n">omega</span>  <span class="o">*</span> <span class="p">(</span> <span class="n">A1p5</span><span class="p">)</span>
        <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="ow">in</span> <span class="n">PNorder</span><span class="p">)</span> <span class="o">*</span> <span class="n">omega</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">A2</span> <span class="p">)</span> 
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span>


    
<span class="k">def</span><span class="w"> </span><span class="nf">a_to_omega</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">PNorder</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">2</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert semi-major axis a to orbit-avareged orbital frequency (in natural units, c=G=M=1). We inverted equation B2a in Kidder et al. 2018.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta1: float</span>
<span class="sd">        Angle between orbital angular momentum and primary spin.</span>
<span class="sd">    theta2: float</span>
<span class="sd">        Angle between orbital angular momentum and secondary spin.</span>
<span class="sd">    deltaphi: float</span>
<span class="sd">        Angle between the projections of the two spins onto the orbital plane.</span>
<span class="sd">    a: float</span>
<span class="sd">        Semi-major axis.</span>
<span class="sd">    e: float</span>
<span class="sd">        Eccentricity: 0&lt;=e&lt;1.</span>
<span class="sd">    q: float</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    chi1: float</span>
<span class="sd">        Dimensionless spin of the primary (heavier) black hole: 0&lt;=chi1&lt;=1.</span>
<span class="sd">    chi2: float</span>
<span class="sd">        Dimensionless spin of the secondary (lighter) black hole: 0&lt;=chi2&lt;=1.</span>

<span class="sd">    PNorder: array (default: [0,1,1.5,2])</span>
<span class="sd">        PN orders considered.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    oemga: float</span>
<span class="sd">        Binary separation.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``omega = precession.a_to_omega(theta1,theta2,deltaphi,a,e,q,chi1,chi2,PNorder=[0,1,1.5,2])``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">theta1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">theta2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">deltaphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
   

    <span class="n">B1</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="mi">17</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))))</span>     
    <span class="n">B1p5</span><span class="o">=-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="p">)))</span> <span class="o">*</span> <span class="n">chi1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">q</span><span class="p">)))</span> <span class="o">*</span> <span class="n">chi2</span><span class="p">)</span>
    <span class="n">B2</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span> <span class="o">*</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">75</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">60</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">147</span> <span class="o">+</span> <span class="p">(</span><span class="mi">563</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="p">(</span><span class="mi">835</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> \
    <span class="o">+</span> <span class="p">(</span><span class="mi">563</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">147</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)))))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">9</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">323</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">216</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> \
    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span> <span class="o">*</span> <span class="n">chi1</span> <span class="o">*</span> <span class="n">chi2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">25</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span> <span class="o">+</span> <span class="p">((</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">323</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">216</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">*</span> <span class="n">chi1</span> <span class="o">*</span> <span class="n">chi2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">*</span> <span class="n">chi1</span> <span class="o">*</span> <span class="n">chi2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">18</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))))</span> <span class="o">+</span> <span class="p">((</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">499</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">312</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span> <span class="o">*</span> <span class="n">chi1</span> <span class="o">*</span> <span class="n">chi2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))))</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">36</span> <span class="o">+</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">19</span> <span class="o">+</span> <span class="p">(</span><span class="mi">108</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> \
    <span class="o">*</span> <span class="n">chi1</span> <span class="o">*</span> <span class="n">chi2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">*</span> <span class="n">chi1</span> <span class="o">*</span> <span class="n">chi2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))))))</span> <span class="o">+</span> <span class="p">((</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">36</span> <span class="o">+</span> \
    <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="p">((</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">312</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> \
    <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> \
    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span> <span class="o">*</span> <span class="n">chi1</span> <span class="o">*</span> <span class="n">chi2</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))))</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">19</span> <span class="o">+</span> <span class="p">(</span><span class="mi">108</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
    <span class="p">((</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">chi1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">*</span> <span class="n">chi2</span> <span class="o">+</span> \
    <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">*</span> <span class="n">chi2</span><span class="p">)))))))))))))))))))</span>

    <span class="n">omega</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">PNorder</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> 
        <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">PNorder</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">B1</span> <span class="p">)</span> 
        <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span> <span class="ow">in</span> <span class="n">PNorder</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>  <span class="o">*</span> <span class="p">(</span> <span class="n">B1p5</span><span class="p">)</span>
        <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="ow">in</span> <span class="n">PNorder</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">B2</span> <span class="p">)</span> 
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">omega</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gwfrequency_maxharmonic</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;W03&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;W03&#39;</span><span class="p">:</span>
        <span class="c1"># W03: Eq. 36 in Wen 2003, arXiv:astro-ph/0211492</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">e</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.1954</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H21&#39;</span><span class="p">:</span>
        <span class="c1"># H21: Eq. 6 in Hamers 2021, arXiv:2111.08033</span>
        <span class="n">c1</span><span class="o">=-</span><span class="mf">1.01678</span>
        <span class="n">c2</span><span class="o">=</span><span class="mf">5.57372</span>
        <span class="n">c3</span><span class="o">=-</span><span class="mf">4.9271</span>
        <span class="n">c4</span><span class="o">=</span><span class="mf">1.68506</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span> <span class="n">c1</span><span class="o">*</span><span class="n">e</span><span class="o">+</span><span class="n">c2</span><span class="o">*</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">c3</span><span class="o">*</span><span class="n">e</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="n">c4</span><span class="o">*</span><span class="n">e</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown method for computing the maximum harmonic. Use &#39;W03&#39; or &#39;H21&#39;.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="k">def</span><span class="w"> </span><span class="nf">a_to_gwfrequency</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">M_msun</span><span class="p">,</span> <span class="n">harmonic</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">PNorder</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">2</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert PN orbital separation in natural units (c=G=M=1) to GW frequency in Hz. We use the 2PN expression reported in Eq. 4.5 of Kidder 1995, arxiv:gr-qc/9506022.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta1: float</span>
<span class="sd">        Angle between orbital angular momentum and primary spin.</span>
<span class="sd">    theta2: float</span>
<span class="sd">        Angle between orbital angular momentum and secondary spin.</span>
<span class="sd">    deltaphi: float</span>
<span class="sd">        Angle between the projections of the two spins onto the orbital plane.</span>
<span class="sd">    a: float</span>
<span class="sd">        Semi-major axis.</span>
<span class="sd">    e: float</span>
<span class="sd">        Eccentricity: 0&lt;=e&lt;1.    </span>
<span class="sd">    q: float</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    chi1: float</span>
<span class="sd">        Dimensionless spin of the primary (heavier) black hole: 0&lt;=chi1&lt;=1.</span>
<span class="sd">    chi2: float</span>
<span class="sd">        Dimensionless spin of the secondary (lighter) black hole: 0&lt;=chi2&lt;=1.</span>
<span class="sd">    M_msun: float</span>
<span class="sd">        Total mass of the binary in solar masses.</span>
<span class="sd">    harmonic: int (default: 2)  </span>
<span class="sd">        Harmonic of the gravitational wave frequency. Default is 2, which corresponds to the fundamental frequency. </span>
<span class="sd">    PNorder: array (default: [0,1,1.5,2])</span>
<span class="sd">        PN orders considered.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fGW: float</span>
<span class="sd">        Gravitational-wave frequency.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``fGW = precession.pnseparation_to_gwfrequency(theta1,theta2,deltaphi,r,q,chi1,chi2,M_msun,PNorder=[0,1,1.5,2])``</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">theta1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">theta2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">deltaphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">M_msun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">M_msun</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">omega_geom</span> <span class="o">=</span> <span class="n">a_to_omega</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">PNorder</span><span class="o">=</span><span class="n">PNorder</span><span class="p">)</span>
    
    <span class="c1"># Prefactor is pi*Msun*G/c^3/s. It&#39;s pi and not 2pi because f is the GW frequency while Kidder&#39;s omega is the orbital angular velocity</span>
    <span class="c1">#c=np.float64(299792458.0)</span>
   <span class="c1"># msun=np.float64(1.988409870698051e+30) # Solar mass in kg</span>
    <span class="c1">#G=np.float64(6.6743e-11) # Gravitational constant in m^3/(kg*s^2)</span>

    <span class="n">fGW</span> <span class="o">=</span> <span class="n">harmonic</span><span class="o">*</span><span class="n">omega_geom</span><span class="o">/</span><span class="p">(</span><span class="mf">3.0947772352865664e-05</span><span class="o">*</span><span class="n">M_msun</span><span class="p">)</span> 


    <span class="k">return</span> <span class="n">fGW</span>




<span class="k">def</span><span class="w"> </span><span class="nf">gwfrequency_to_a</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">fgw</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">M_msun</span><span class="p">,</span> <span class="n">harmonic</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">PNorder</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">2</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert PN orbital separation in natural units (c=G=M=1) to GW frequency in Hz. We use the 2PN expression reported in Eq. 4.5 of Kidder 1995, arxiv:gr-qc/9506022.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta1: float</span>
<span class="sd">        Angle between orbital angular momentum and primary spin.</span>
<span class="sd">    theta2: float</span>
<span class="sd">        Angle between orbital angular momentum and secondary spin.</span>
<span class="sd">    deltaphi: float</span>
<span class="sd">        Angle between the projections of the two spins onto the orbital plane.</span>
<span class="sd">    fgw: float</span>
<span class="sd">        Gravitational wave frequency.</span>
<span class="sd">    e: float</span>
<span class="sd">        Eccentricity: 0&lt;=e&lt;1.    </span>
<span class="sd">    q: float</span>
<span class="sd">        Mass ratio: 0&lt;=q&lt;=1.</span>
<span class="sd">    chi1: float</span>
<span class="sd">        Dimensionless spin of the primary (heavier) black hole: 0&lt;=chi1&lt;=1.</span>
<span class="sd">    chi2: float</span>
<span class="sd">        Dimensionless spin of the secondary (lighter) black hole: 0&lt;=chi2&lt;=1.</span>
<span class="sd">    M_msun: float</span>
<span class="sd">        Total mass of the binary in solar masses.</span>
<span class="sd">    harmonic: int (default: 2)  </span>
<span class="sd">        Harmonic of the gravitational wave frequency. Default is 2, which corresponds to the fundamental frequency.     </span>
<span class="sd">    PNorder: array (default: [0,1,1.5,2])</span>
<span class="sd">        PN orders considered.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fGW: float</span>
<span class="sd">        Gravitational-wave frequency.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ``fGW = precession.pnseparation_to_gwfrequency(theta1,theta2,deltaphi,r,q,chi1,chi2,M_msun,PNorder=[0,1,1.5,2])``</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">theta1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">theta2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">deltaphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">deltaphi</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">fgw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">fgw</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">chi2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">M_msun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">M_msun</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1">#c=np.float64(299792458.0)</span>
    <span class="c1">#msun=np.float64(1.988409870698051e+30) # Solar mass in kg</span>
    <span class="c1">#G=np.float64(6.6743e-11) # Gravitational constant in m^3/(kg*s^2)</span>

    <span class="n">omega</span><span class="o">=</span> <span class="p">(</span><span class="n">fgw</span><span class="o">*</span><span class="n">M_msun</span><span class="o">*</span><span class="mf">3.0947772352865664e-05</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">harmonic</span><span class="p">)</span>  <span class="c1"># Convert fGW to omega in natural units</span>
    <span class="n">a_geom</span> <span class="o">=</span> <span class="n">omega_to_a</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">deltaphi</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">PNorder</span><span class="o">=</span><span class="n">PNorder</span><span class="p">)</span>
    
    
    <span class="n">a</span> <span class="o">=</span> <span class="n">a_geom</span>

    <span class="k">return</span> <span class="n">a</span>

<span class="n">all_fun</span><span class="o">=</span><span class="n">functions</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;eval_a&#39;</span><span class="p">,</span> <span class="s1">&#39;eval_e&#39;</span><span class="p">,</span> <span class="s1">&#39;ddchidt_prefactor&#39;</span><span class="p">,</span> <span class="s1">&#39;vectors_to_conserved&#39;</span><span class="p">,</span><span class="s1">&#39;inspiral_precav&#39;</span><span class="p">,</span><span class="s1">&#39;rhs_orbav&#39;</span><span class="p">,</span> <span class="s1">&#39;integrator_orbav&#39;</span><span class="p">,</span> <span class="s1">&#39;inspiral_orbav&#39;</span> <span class="p">,</span><span class="s1">&#39;inspiral_hybrid&#39;</span><span class="p">,</span><span class="s1">&#39;implicit&#39;</span><span class="p">]</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="n">all_fun</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) Davide Gerosa.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>